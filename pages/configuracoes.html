<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyCore ‚Äî Configura√ß√µes</title>
  <link rel="stylesheet" href="../css/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="bg-orb bg-orb-1"></div><div class="bg-orb bg-orb-2"></div><div class="bg-orb bg-orb-3"></div>

<div class="layout">
  <div class="sidebar-backdrop" id="sidebar-backdrop"></div>
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-logo"><div class="logo-icon glow-pulse">‚ö°</div><div class="logo-text">My<span>Core</span></div></div>
    <div class="sidebar-nav">
      <div class="nav-section-label">Principal</div>
      <a class="nav-item" href="dashboard.html"><i class="fas fa-th-large"></i><span class="nav-label-text">Dashboard</span></a>
      <a class="nav-item" href="financas.html"><i class="fas fa-wallet"></i><span class="nav-label-text">Finan√ßas</span></a>
      <div class="nav-section-label">Crescimento</div>
      <a class="nav-item" href="metas.html"><i class="fas fa-bullseye"></i><span class="nav-label-text">Metas & Objetivos</span><span class="nav-badge" id="badge-metas">0</span></a>
      <a class="nav-item" href="desenvolvimento.html"><i class="fas fa-seedling"></i><span class="nav-label-text">Desenvolvimento</span></a>
      <a class="nav-item" href="conquistas.html"><i class="fas fa-trophy"></i><span class="nav-label-text">Conquistas</span></a>
      <div class="nav-section-label">An√°lise</div>
      <a class="nav-item" href="relatorios.html"><i class="fas fa-chart-line"></i><span class="nav-label-text">Relat√≥rios</span></a>
      <a class="nav-item active" href="configuracoes.html"><i class="fas fa-cog"></i><span class="nav-label-text">Configura√ß√µes</span></a>
    </div>
    <div class="sidebar-footer">
      <button class="toggle-sidebar-btn" id="sidebar-toggle-btn"><i class="fas fa-chevron-left" id="sidebar-toggle-icon"></i><span class="nav-label-text">Recolher menu</span></button>
    </div>
  </nav>

  <div class="main" id="main">
    <header class="topbar">
      <button class="hamburger-btn" id="hamburger-btn"><i class="fas fa-bars"></i></button>
      <div class="topbar-title">Configura√ß√µes</div>
      <div class="topbar-date" id="topbar-date"></div>
      <div class="topbar-score"><i class="fas fa-star" style="color:var(--accent2)"></i><span style="color:var(--text2);font-size:13px">Life Score</span><span class="score-badge" id="life-score-top">‚Äî</span></div>
      <div class="topbar-user" onclick="Auth.logout()"><i class="fas fa-user-circle" style="color:var(--accent)"></i><span id="topbar-username">‚Äî</span><i class="fas fa-sign-out-alt" style="color:var(--text3);margin-left:4px"></i></div>
    </header>

    <main class="content" id="main-content">
      <div class="page-body">
        <div class="section-title" style="margin-bottom:4px">Configura√ß√µes</div>
        <div class="section-sub" style="margin-bottom:24px">Personalize sua experi√™ncia no MyCore.</div>

        <!-- Profile Hero -->
        <div class="profile-hero">
          <div class="profile-avatar" id="profile-avatar">?</div>
          <div>
            <div class="profile-name" id="profile-name">‚Äî</div>
            <div class="profile-phrase" id="profile-phrase"></div>
            <div class="profile-since">Membro desde <span id="profile-since">‚Äî</span></div>
          </div>
        </div>

        <div class="grid-2">
          <!-- Profile form -->
          <div class="card">
            <div class="card-title" style="margin-bottom:20px">Perfil</div>
            <div class="form-group">
              <label class="form-label">Seu Nome</label>
              <input type="text" class="form-control" id="config-name" placeholder="Como quer ser chamado?" oninput="livePreview()">
            </div>
            <div class="form-group">
              <label class="form-label">Frase Motivacional</label>
              <input type="text" class="form-control" id="config-phrase" placeholder="Sua frase de vida" oninput="livePreview()">
            </div>
            <div class="form-group">
              <label class="form-label">Meta de Economia Mensal (R$)</label>
              <input type="number" class="form-control" id="config-meta" placeholder="0,00" min="0" step="0.01">
            </div>
            <button class="btn btn-primary" onclick="saveConfig()" style="margin-top:4px">
              <i class="fas fa-save"></i> Salvar Perfil
            </button>
          </div>

          <!-- Account info -->
          <div class="card">
            <div class="card-title" style="margin-bottom:20px">Conta</div>
            <div style="background:var(--surface);border-radius:var(--radius-sm);padding:14px;margin-bottom:16px">
              <div style="font-size:12px;color:var(--text3);margin-bottom:4px">E-mail cadastrado</div>
              <div style="font-family:var(--font-mono);font-size:14px" id="account-email">‚Äî</div>
            </div>

            <div class="divider"></div>

            <div class="card-title" style="margin:16px 0 14px">Dados & Seguran√ßa</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn btn-ghost" onclick="exportJSON()"><i class="fas fa-download"></i> Exportar JSON</button>
              <button class="btn btn-danger" onclick="confirmClear()"><i class="fas fa-trash"></i> Limpar dados</button>
            </div>

            <div class="divider"></div>

            <button class="btn btn-ghost" style="width:100%;margin-top:4px;color:var(--accent4)" onclick="Auth.logout()">
              <i class="fas fa-sign-out-alt"></i> Sair da conta
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<div class="modal-overlay" id="modal-overlay"><div class="modal" id="modal-box"></div></div>
<div class="toast" id="toast"><span class="toast-icon" id="toast-icon">‚úÖ</span><span id="toast-msg"></span></div>

<script src="../js/auth.js"></script>
<script src="../js/db.js"></script>
<script src="../js/utils.js"></script>
<script>
const currentUser = Auth.requireAuth('../index.html');
if (!currentUser) throw new Error();
const data = DB.load(currentUser.email);

updateTopbarDate(); updateTopbarUser(currentUser); initSidebar(); initModalOverlay(); initSmoothScroll('main-content');
document.getElementById('life-score-top').textContent = calcLifeScore(data).total;
const badge = document.getElementById('badge-metas');
if (badge) { badge.textContent = data.goals.filter(g => g.progress < 100).length; }

// Fill form
document.getElementById('config-name').value  = data.config.name || '';
document.getElementById('config-phrase').value = data.config.phrase || '';
document.getElementById('config-meta').value   = data.config.metaMensal || '';
document.getElementById('account-email').textContent = currentUser.email;

function updateProfileHero() {
  const name   = data.config.name || currentUser.name;
  const phrase = data.config.phrase;
  document.getElementById('profile-avatar').textContent = (name[0] || '?').toUpperCase();
  document.getElementById('profile-name').textContent   = name;
  document.getElementById('profile-phrase').textContent = phrase;
  document.getElementById('profile-since').textContent  = data.config.memberSince || '‚Äî';
}

function livePreview() {
  const n = document.getElementById('config-name').value;
  const p = document.getElementById('config-phrase').value;
  if (n) { document.getElementById('profile-name').textContent = n; document.getElementById('profile-avatar').textContent = n[0].toUpperCase(); }
  if (p) document.getElementById('profile-phrase').textContent = p;
}

function saveConfig() {
  const name  = document.getElementById('config-name').value.trim();
  const phrase = document.getElementById('config-phrase').value.trim();
  const meta  = parseFloat(document.getElementById('config-meta').value) || 0;
  if (name)  data.config.name  = name;
  if (phrase) data.config.phrase = phrase;
  data.config.metaMensal = meta;
  DB.save();
  updateProfileHero();
  updateTopbarUser({ name: data.config.name || currentUser.name });
  showToast('Perfil salvo!', '‚úÖ');
}

function exportJSON() {
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url  = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `mycore_backup_${today()}.json`; a.click();
  URL.revokeObjectURL(url);
  showToast('Dados exportados!', 'üìÅ');
}

function confirmClear() {
  openModal(`
    <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
    <div class="modal-title" style="color:var(--accent4)">‚ö†Ô∏è Limpar todos os dados?</div>
    <p style="color:var(--text2);margin-bottom:20px">Esta a√ß√£o √© <strong>irrevers√≠vel</strong>. Todas as suas transa√ß√µes, metas, h√°bitos e progresso ser√£o apagados permanentemente.</p>
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
      <button class="btn btn-danger" onclick="clearData()"><i class="fas fa-trash"></i> Sim, apagar tudo</button>
    </div>`);
}

function clearData() {
  localStorage.removeItem(Auth.getDataKey(currentUser.email));
  window.location.href = 'dashboard.html';
}

updateProfileHero();
</script>
</body>
</html>
