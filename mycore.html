<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyCore â€” Centro de Controle</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #080810;
    --bg2: #0f0f1a;
    --bg3: #16162a;
    --surface: #1a1a2e;
    --surface2: #22223a;
    --border: rgba(255,255,255,0.07);
    --accent: #6C63FF;
    --accent2: #F0B429;
    --accent3: #00D9A5;
    --accent4: #FF6B6B;
    --text: #E8E8F0;
    --text2: #9090B0;
    --text3: #5a5a7a;
    --glow: rgba(108,99,255,0.4);
    --glow2: rgba(240,180,41,0.3);
    --font-display: 'DM Serif Display', serif;
    --font-body: 'DM Sans', sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
    --radius: 16px;
    --radius-sm: 10px;
    --transition: 0.25s cubic-bezier(0.4,0,0.2,1);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    overflow: hidden;
  }

  /* ========== SCROLLBAR ========== */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--surface2); border-radius: 2px; }

  /* ========== SIDEBAR ========== */
  .sidebar {
    width: 260px;
    min-height: 100vh;
    background: var(--bg2);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    padding: 28px 0;
    position: fixed;
    left: 0; top: 0; bottom: 0;
    z-index: 100;
    transition: width var(--transition);
  }

  .sidebar.collapsed { width: 72px; }

  .sidebar-logo {
    padding: 0 24px 32px;
    display: flex;
    align-items: center;
    gap: 14px;
    overflow: hidden;
    white-space: nowrap;
  }

  .logo-icon {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--accent), #9B8FFF);
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
    box-shadow: 0 0 20px var(--glow);
  }

  .logo-text {
    font-family: var(--font-display);
    font-size: 22px;
    color: var(--text);
    letter-spacing: -0.5px;
  }

  .logo-text span { color: var(--accent); }

  .sidebar-nav { flex: 1; padding: 0 12px; display: flex; flex-direction: column; gap: 4px; }

  .nav-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--text3);
    padding: 16px 12px 8px;
    white-space: nowrap;
    overflow: hidden;
  }

  .collapsed .nav-label { opacity: 0; }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 14px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all var(--transition);
    white-space: nowrap;
    overflow: hidden;
    position: relative;
    color: var(--text2);
    font-weight: 500;
    font-size: 14px;
  }

  .nav-item:hover { background: var(--surface); color: var(--text); }

  .nav-item.active {
    background: linear-gradient(135deg, rgba(108,99,255,0.2), rgba(108,99,255,0.05));
    color: var(--accent);
    border: 1px solid rgba(108,99,255,0.2);
  }

  .nav-item.active::before {
    content: '';
    position: absolute;
    left: 0; top: 50%;
    transform: translateY(-50%);
    width: 3px; height: 20px;
    background: var(--accent);
    border-radius: 0 2px 2px 0;
  }

  .nav-item i { font-size: 16px; min-width: 20px; text-align: center; }
  .nav-item span { opacity: 1; transition: opacity var(--transition); }
  .collapsed .nav-item span { opacity: 0; }

  .nav-badge {
    margin-left: auto;
    background: var(--accent);
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 20px;
    min-width: 20px;
    text-align: center;
  }

  .sidebar-footer {
    padding: 16px 12px 0;
    border-top: 1px solid var(--border);
    margin-top: 12px;
  }

  .toggle-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    color: var(--text2);
    font-size: 13px;
    transition: all var(--transition);
    border: none;
    background: none;
    width: 100%;
    white-space: nowrap;
    overflow: hidden;
  }

  .toggle-btn:hover { background: var(--surface); color: var(--text); }
  .collapsed .toggle-btn span { opacity: 0; }

  /* ========== MAIN ========== */
  .main {
    margin-left: 260px;
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    transition: margin-left var(--transition);
  }

  .main.expanded { margin-left: 72px; }

  /* ========== TOPBAR ========== */
  .topbar {
    height: 70px;
    background: rgba(8,8,16,0.8);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 32px;
    gap: 20px;
    position: sticky;
    top: 0;
    z-index: 50;
  }

  .topbar-title {
    font-family: var(--font-display);
    font-size: 20px;
    flex: 1;
  }

  .topbar-date {
    font-size: 13px;
    color: var(--text2);
    font-family: var(--font-mono);
  }

  .topbar-score {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 100px;
    padding: 8px 16px;
    font-size: 13px;
  }

  .score-badge {
    font-family: var(--font-mono);
    font-size: 15px;
    font-weight: 600;
    color: var(--accent2);
  }

  .quick-add-btn {
    background: linear-gradient(135deg, var(--accent), #9B8FFF);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 100px;
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all var(--transition);
    box-shadow: 0 4px 20px var(--glow);
  }

  .quick-add-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 28px var(--glow); }

  /* ========== CONTENT ========== */
  .content {
    flex: 1;
    padding: 32px;
    overflow-y: auto;
    height: calc(100vh - 70px);
  }

  /* ========== TABS / PAGES ========== */
  .page { display: none; animation: fadeSlide 0.3s ease; }
  .page.active { display: block; }

  @keyframes fadeSlide {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ========== GRID ========== */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
  .grid-4 { display: grid; grid-template-columns: repeat(4,1fr); gap: 20px; }
  .col-span-2 { grid-column: span 2; }
  .col-span-3 { grid-column: span 3; }

  /* ========== CARDS ========== */
  .card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    transition: all var(--transition);
    position: relative;
    overflow: hidden;
  }

  .card:hover { border-color: rgba(108,99,255,0.2); }

  .card-glow {
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: radial-gradient(ellipse at center, var(--glow) 0%, transparent 60%);
    opacity: 0;
    transition: opacity 0.5s;
    pointer-events: none;
  }

  .card:hover .card-glow { opacity: 1; }

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .card-title {
    font-size: 13px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text2);
  }

  .card-icon {
    width: 36px; height: 36px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 15px;
  }

  /* ========== STAT CARDS ========== */
  .stat-value {
    font-family: var(--font-mono);
    font-size: 32px;
    font-weight: 600;
    line-height: 1;
    margin-bottom: 8px;
  }

  .stat-label { font-size: 13px; color: var(--text2); margin-bottom: 12px; }

  .stat-change {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 100px;
  }

  .stat-change.up { background: rgba(0,217,165,0.12); color: var(--accent3); }
  .stat-change.down { background: rgba(255,107,107,0.12); color: var(--accent4); }

  /* ========== PROGRESS ========== */
  .progress-bar-wrap {
    background: var(--surface);
    border-radius: 100px;
    height: 6px;
    overflow: hidden;
    margin-top: 12px;
  }

  .progress-bar {
    height: 100%;
    border-radius: 100px;
    background: linear-gradient(90deg, var(--accent), #9B8FFF);
    transition: width 1s cubic-bezier(0.4,0,0.2,1);
  }

  .progress-bar.gold { background: linear-gradient(90deg, var(--accent2), #FFD700); }
  .progress-bar.green { background: linear-gradient(90deg, var(--accent3), #00FF95); }
  .progress-bar.red { background: linear-gradient(90deg, var(--accent4), #FF9B9B); }

  /* ========== CIRCULAR PROGRESS ========== */
  .circular-progress {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .circular-progress svg { transform: rotate(-90deg); }

  .circular-progress .cp-value {
    position: absolute;
    font-family: var(--font-mono);
    font-weight: 600;
    font-size: 18px;
  }

  /* ========== SECTION TITLES ========== */
  .section-title {
    font-family: var(--font-display);
    font-size: 28px;
    margin-bottom: 8px;
    color: var(--text);
  }

  .section-sub {
    color: var(--text2);
    font-size: 14px;
    margin-bottom: 28px;
  }

  /* ========== TRANSACTIONS ========== */
  .transaction-list { display: flex; flex-direction: column; gap: 8px; }

  .transaction-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 12px 16px;
    background: var(--surface);
    border-radius: var(--radius-sm);
    transition: all var(--transition);
    cursor: pointer;
  }

  .transaction-item:hover { background: var(--surface2); }

  .tx-icon {
    width: 38px; height: 38px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
  }

  .tx-info { flex: 1; }
  .tx-name { font-size: 14px; font-weight: 500; }
  .tx-category { font-size: 12px; color: var(--text2); margin-top: 2px; }
  .tx-date { font-size: 11px; color: var(--text3); }

  .tx-amount {
    font-family: var(--font-mono);
    font-weight: 600;
    font-size: 14px;
  }

  .tx-amount.income { color: var(--accent3); }
  .tx-amount.expense { color: var(--accent4); }

  /* ========== GOALS ========== */
  .goal-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    transition: all var(--transition);
    cursor: pointer;
  }

  .goal-card:hover { border-color: rgba(108,99,255,0.3); transform: translateY(-2px); }

  .goal-emoji { font-size: 28px; margin-bottom: 12px; }
  .goal-name { font-weight: 600; font-size: 15px; margin-bottom: 4px; }
  .goal-desc { font-size: 12px; color: var(--text2); margin-bottom: 16px; }
  .goal-nums { display: flex; justify-content: space-between; font-size: 12px; color: var(--text2); margin-top: 8px; }
  .goal-percent { font-family: var(--font-mono); font-weight: 700; font-size: 13px; }

  /* ========== HABITS ========== */
  .habit-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 18px;
    background: var(--surface);
    border-radius: var(--radius-sm);
    transition: all var(--transition);
    margin-bottom: 8px;
  }

  .habit-icon {
    font-size: 20px;
    width: 36px;
    text-align: center;
  }

  .habit-info { flex: 1; }
  .habit-name { font-size: 14px; font-weight: 500; }
  .habit-streak {
    font-size: 12px;
    color: var(--accent2);
    margin-top: 2px;
    font-family: var(--font-mono);
  }

  .habit-dots {
    display: flex;
    gap: 5px;
  }

  .habit-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--surface2);
    transition: all var(--transition);
  }

  .habit-dot.done { background: var(--accent3); }

  .habit-check {
    width: 28px; height: 28px;
    border-radius: 50%;
    border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    transition: all var(--transition);
    font-size: 13px;
    color: transparent;
  }

  .habit-check.checked { background: var(--accent3); border-color: var(--accent3); color: white; }
  .habit-check:hover { border-color: var(--accent3); }

  /* ========== ACHIEVEMENTS ========== */
  .achievement-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 16px; }

  .achievement-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px 16px;
    text-align: center;
    transition: all var(--transition);
    cursor: pointer;
  }

  .achievement-card.unlocked {
    border-color: rgba(240,180,41,0.3);
    background: linear-gradient(135deg, rgba(240,180,41,0.05), var(--bg2));
  }

  .achievement-card.locked { opacity: 0.4; filter: grayscale(1); }

  .achievement-card:hover { transform: translateY(-3px); }

  .achievement-icon { font-size: 36px; margin-bottom: 12px; }
  .achievement-name { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
  .achievement-desc { font-size: 11px; color: var(--text2); }
  .achievement-badge {
    display: inline-block;
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 100px;
    margin-top: 8px;
    font-weight: 700;
    letter-spacing: 0.5px;
  }

  .achievement-badge.gold { background: rgba(240,180,41,0.2); color: var(--accent2); }
  .achievement-badge.silver { background: rgba(180,180,200,0.15); color: #B0B0C0; }
  .achievement-badge.locked-badge { background: var(--surface); color: var(--text3); }

  /* ========== SCORE RING (Dashboard) ========== */
  .score-section {
    display: flex;
    align-items: center;
    gap: 32px;
  }

  .score-ring-wrap {
    position: relative;
    flex-shrink: 0;
  }

  .score-details { flex: 1; }
  .score-details .score-num {
    font-family: var(--font-display);
    font-size: 52px;
    line-height: 1;
    color: var(--accent2);
  }

  .score-details .score-sub { font-size: 14px; color: var(--text2); margin: 8px 0 20px; }

  .score-items { display: flex; flex-direction: column; gap: 10px; }
  .score-item { display: flex; align-items: center; gap: 12px; font-size: 13px; }
  .score-item-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .score-item-label { color: var(--text2); flex: 1; }
  .score-item-val { font-family: var(--font-mono); font-weight: 600; }

  /* ========== CHART ========== */
  .chart-wrap { position: relative; }
  canvas { max-width: 100%; }

  /* ========== MODAL ========== */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(8px);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s;
  }

  .modal-overlay.open { opacity: 1; pointer-events: all; }

  .modal {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 32px;
    width: 480px;
    max-width: 90vw;
    transform: scale(0.95) translateY(10px);
    transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
  }

  .modal-overlay.open .modal { transform: scale(1) translateY(0); }

  .modal-title {
    font-family: var(--font-display);
    font-size: 22px;
    margin-bottom: 24px;
  }

  .modal-close {
    float: right;
    background: none;
    border: none;
    color: var(--text2);
    cursor: pointer;
    font-size: 18px;
    transition: color var(--transition);
  }

  .modal-close:hover { color: var(--text); }

  /* ========== FORMS ========== */
  .form-group { margin-bottom: 16px; }

  .form-label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text2);
    margin-bottom: 8px;
  }

  .form-control {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    color: var(--text);
    font-family: var(--font-body);
    font-size: 14px;
    transition: all var(--transition);
    outline: none;
  }

  .form-control:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(108,99,255,0.15); }

  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

  .btn {
    padding: 12px 24px;
    border-radius: var(--radius-sm);
    border: none;
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition);
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--accent), #9B8FFF);
    color: white;
    box-shadow: 0 4px 16px var(--glow);
  }

  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 24px var(--glow); }

  .btn-ghost {
    background: var(--surface);
    color: var(--text2);
    border: 1px solid var(--border);
  }

  .btn-ghost:hover { background: var(--surface2); color: var(--text); }

  .btn-row { display: flex; gap: 10px; justify-content: flex-end; margin-top: 24px; }

  /* ========== CATEGORY CHIPS ========== */
  .chip-select { display: flex; flex-wrap: wrap; gap: 8px; }

  .chip {
    padding: 7px 14px;
    border-radius: 100px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text2);
    transition: all var(--transition);
  }

  .chip.selected { background: rgba(108,99,255,0.2); border-color: var(--accent); color: var(--accent); }

  /* ========== RADAR CHART SECTION ========== */
  .radar-section { display: flex; align-items: center; gap: 32px; }
  .radar-labels { flex: 1; display: flex; flex-direction: column; gap: 12px; }

  .radar-label-item { display: flex; align-items: center; gap: 12px; }
  .radar-dot { width: 10px; height: 10px; border-radius: 50%; }
  .radar-label-name { font-size: 13px; color: var(--text2); flex: 1; }
  .radar-label-val { font-family: var(--font-mono); font-size: 13px; font-weight: 600; }

  /* ========== REPORT SECTION ========== */
  .report-card {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px;
    background: var(--surface);
    border-radius: var(--radius-sm);
    margin-bottom: 12px;
    cursor: pointer;
    transition: all var(--transition);
  }

  .report-card:hover { background: var(--surface2); }

  .report-icon { font-size: 24px; }
  .report-info { flex: 1; }
  .report-name { font-weight: 600; font-size: 14px; }
  .report-desc { font-size: 12px; color: var(--text2); margin-top: 2px; }
  .report-arrow { color: var(--text3); }

  /* ========== PROFILE ========== */
  .profile-hero {
    background: linear-gradient(135deg, rgba(108,99,255,0.15), rgba(240,180,41,0.05));
    border: 1px solid rgba(108,99,255,0.15);
    border-radius: var(--radius);
    padding: 32px;
    display: flex;
    align-items: center;
    gap: 28px;
    margin-bottom: 24px;
  }

  .profile-avatar {
    width: 80px; height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), #9B8FFF);
    display: flex; align-items: center; justify-content: center;
    font-size: 32px;
    font-family: var(--font-display);
    font-weight: 700;
    flex-shrink: 0;
    border: 3px solid rgba(108,99,255,0.4);
    box-shadow: 0 0 30px var(--glow);
    cursor: pointer;
  }

  .profile-name { font-family: var(--font-display); font-size: 26px; }
  .profile-phrase { color: var(--text2); font-size: 14px; margin-top: 6px; font-style: italic; }
  .profile-since { font-size: 12px; color: var(--text3); margin-top: 8px; }

  /* ========== ANIMATIONS ========== */
  @keyframes pulse-glow {
    0%, 100% { box-shadow: 0 0 20px var(--glow); }
    50% { box-shadow: 0 0 40px var(--glow), 0 0 60px rgba(108,99,255,0.2); }
  }

  .glow-pulse { animation: pulse-glow 3s infinite; }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }

  /* ========== BG ELEMENTS ========== */
  .bg-orb {
    position: fixed;
    border-radius: 50%;
    filter: blur(80px);
    pointer-events: none;
    z-index: 0;
  }

  .bg-orb-1 {
    width: 400px; height: 400px;
    background: rgba(108,99,255,0.06);
    top: -100px; right: 100px;
  }

  .bg-orb-2 {
    width: 300px; height: 300px;
    background: rgba(240,180,41,0.04);
    bottom: 100px; right: 300px;
  }

  .bg-orb-3 {
    width: 250px; height: 250px;
    background: rgba(0,217,165,0.03);
    top: 50%; left: 40%;
  }

  /* ========== EMPTY STATE ========== */
  .empty-state {
    text-align: center;
    padding: 48px 24px;
    color: var(--text2);
  }

  .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.4; }
  .empty-state h3 { font-family: var(--font-display); font-size: 20px; margin-bottom: 8px; color: var(--text); }
  .empty-state p { font-size: 14px; }

  /* ========== SKILL BARS ========== */
  .skill-item { margin-bottom: 16px; }
  .skill-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; }
  .skill-level { font-family: var(--font-mono); font-weight: 600; color: var(--accent); }

  /* ========== DIVIDER ========== */
  .divider { height: 1px; background: var(--border); margin: 24px 0; }

  /* ========== TAGS ========== */
  .tag {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 10px;
    border-radius: 100px;
    font-size: 11px;
    font-weight: 600;
  }

  /* ========== TOGGLE ========== */
  .toggle-wrap {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 0;
    border-bottom: 1px solid var(--border);
  }

  .toggle-label { font-size: 14px; }
  .toggle-desc { font-size: 12px; color: var(--text2); margin-top: 2px; }

  .toggle {
    width: 44px; height: 24px;
    background: var(--surface2);
    border-radius: 100px;
    position: relative;
    cursor: pointer;
    transition: background var(--transition);
    flex-shrink: 0;
  }

  .toggle.on { background: var(--accent); }

  .toggle::after {
    content: '';
    position: absolute;
    width: 18px; height: 18px;
    background: white;
    border-radius: 50%;
    top: 3px; left: 3px;
    transition: left var(--transition);
  }

  .toggle.on::after { left: 23px; }

  /* ========== DIARY ========== */
  .diary-entry {
    background: var(--surface);
    border-radius: var(--radius-sm);
    padding: 16px 20px;
    margin-bottom: 10px;
    border-left: 3px solid var(--accent);
  }

  .diary-date { font-size: 11px; color: var(--text3); margin-bottom: 6px; font-family: var(--font-mono); }
  .diary-text { font-size: 14px; line-height: 1.6; }

  /* ========== NOTIFICATION ========== */
  .toast {
    position: fixed;
    bottom: 32px; right: 32px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
    z-index: 9999;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  }

  .toast.show { transform: translateY(0); opacity: 1; }
  .toast-icon { font-size: 18px; }

  /* ========== SELECT ========== */
  select.form-control {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%239090B0' d='M6 8L0 0h12z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
    padding-right: 40px;
    cursor: pointer;
  }

  select.form-control option { background: var(--bg2); }

  /* ========== SMOOTH SCROLL ========== */
  html { scroll-behavior: smooth; }
  .content { scroll-behavior: smooth; }
  * { scroll-behavior: smooth; }
  
  /* Custom smooth scroll via JS - applies to .content */
  .content {
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--surface2) transparent;
  }

  /* ========== LOGIN PAGE ========== */
  .login-overlay {
    position: fixed;
    inset: 0;
    background: var(--bg);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    background-image: radial-gradient(ellipse at 20% 30%, rgba(108,99,255,0.12) 0%, transparent 50%),
                      radial-gradient(ellipse at 80% 70%, rgba(240,180,41,0.06) 0%, transparent 50%);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  .login-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .login-box {
    width: 440px;
    max-width: 92vw;
    background: var(--bg2);
    border: 1px solid rgba(108,99,255,0.2);
    border-radius: 24px;
    padding: 48px 40px;
    position: relative;
    box-shadow: 0 32px 80px rgba(0,0,0,0.5), 0 0 60px rgba(108,99,255,0.1);
    animation: loginAppear 0.6s cubic-bezier(0.34,1.56,0.64,1) both;
  }

  @keyframes loginAppear {
    from { opacity: 0; transform: scale(0.9) translateY(20px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }

  .login-logo {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 36px;
    justify-content: center;
  }

  .login-logo-icon {
    width: 48px; height: 48px;
    background: linear-gradient(135deg, var(--accent), #9B8FFF);
    border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    box-shadow: 0 0 30px var(--glow);
    animation: pulse-glow 3s infinite;
  }

  .login-logo-text {
    font-family: var(--font-display);
    font-size: 28px;
    letter-spacing: -0.5px;
  }

  .login-logo-text span { color: var(--accent); }

  .login-tabs {
    display: flex;
    background: var(--surface);
    border-radius: var(--radius-sm);
    padding: 4px;
    margin-bottom: 28px;
  }

  .login-tab {
    flex: 1;
    padding: 10px;
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 8px;
    color: var(--text2);
    transition: all var(--transition);
  }

  .login-tab.active {
    background: var(--bg2);
    color: var(--text);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  .login-form { display: none; }
  .login-form.active { display: block; }

  .login-title {
    font-family: var(--font-display);
    font-size: 22px;
    margin-bottom: 6px;
  }

  .login-sub {
    font-size: 13px;
    color: var(--text2);
    margin-bottom: 24px;
  }

  .login-error {
    background: rgba(255,107,107,0.1);
    border: 1px solid rgba(255,107,107,0.3);
    color: var(--accent4);
    padding: 10px 14px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    margin-bottom: 16px;
    display: none;
  }

  .login-success {
    background: rgba(0,217,165,0.1);
    border: 1px solid rgba(0,217,165,0.3);
    color: var(--accent3);
    padding: 10px 14px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    margin-bottom: 16px;
    display: none;
  }

  .login-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, var(--accent), #9B8FFF);
    border: none;
    border-radius: var(--radius-sm);
    color: white;
    font-size: 15px;
    font-weight: 700;
    font-family: var(--font-body);
    cursor: pointer;
    margin-top: 8px;
    transition: all var(--transition);
    box-shadow: 0 4px 20px var(--glow);
    letter-spacing: 0.3px;
  }

  .login-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 28px var(--glow); }
  .login-btn:active { transform: translateY(0); }

  /* ========== MOBILE HAMBURGER ========== */
  .hamburger {
    display: none;
    background: none;
    border: none;
    color: var(--text);
    font-size: 20px;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: background var(--transition);
  }

  .hamburger:hover { background: var(--surface); }

  .sidebar-backdrop {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(4px);
    z-index: 99;
  }

  .sidebar-backdrop.show { display: block; }

  /* ========== RESPONSIVE ========== */
  @media (max-width: 1200px) {
    .grid-4 { grid-template-columns: repeat(2,1fr); }
    .grid-4 .col-span-3 { grid-column: span 2; }
  }

  @media (max-width: 900px) {
    .grid-3 { grid-template-columns: 1fr 1fr; }
    .grid-3 .col-span-3 { grid-column: span 2; }
    .grid-4 { grid-template-columns: 1fr 1fr; }
    .score-section { flex-direction: column; align-items: flex-start; gap: 20px; }
    .radar-section { flex-direction: column; }
  }

  @media (max-width: 768px) {
    .sidebar {
      transform: translateX(-100%);
      transition: transform var(--transition), width var(--transition);
      z-index: 200;
      width: 260px !important;
    }

    .sidebar.mobile-open {
      transform: translateX(0);
    }

    .sidebar.collapsed {
      width: 260px !important;
      transform: translateX(-100%);
    }

    .main {
      margin-left: 0 !important;
    }

    .hamburger { display: flex; align-items: center; justify-content: center; }

    .topbar { padding: 0 16px; gap: 12px; }
    .topbar-title { font-size: 16px; }
    .topbar-date { display: none; }
    .topbar-score { padding: 6px 12px; }
    .quick-add-btn span { display: none; }
    .quick-add-btn { padding: 10px 14px; }

    .content { padding: 16px; }

    .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
    .grid-2 .col-span-2,
    .grid-3 .col-span-2,
    .grid-3 .col-span-3,
    .grid-4 .col-span-2,
    .grid-4 .col-span-3 { grid-column: span 1; }

    .section-title { font-size: 22px; }

    .form-row { grid-template-columns: 1fr; }

    .stat-value { font-size: 26px; }

    .radar-section { flex-direction: column; }
    .radar-section canvas { width: 180px !important; height: 180px !important; }

    .achievement-grid { grid-template-columns: repeat(2,1fr); }

    .profile-hero { flex-direction: column; text-align: center; }

    .modal { padding: 24px; }
    .modal-title { font-size: 18px; }
  }

  @media (max-width: 480px) {
    .topbar { height: 60px; }
    .content { height: calc(100vh - 60px); padding: 12px; }
    .card { padding: 16px; }
    .achievement-grid { grid-template-columns: 1fr 1fr; }
    .score-details .score-num { font-size: 40px; }
  }

  /* ========== REPORT EXPORT MODAL ========== */
  .export-options {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
    margin: 20px 0;
  }

  .export-option {
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 16px 10px;
    text-align: center;
    cursor: pointer;
    transition: all var(--transition);
  }

  .export-option:hover { border-color: var(--accent); background: rgba(108,99,255,0.08); }
  .export-option.selected { border-color: var(--accent); background: rgba(108,99,255,0.15); }

  .export-option-icon { font-size: 28px; margin-bottom: 8px; }
  .export-option-label { font-size: 12px; font-weight: 700; letter-spacing: 0.5px; }
  .export-option-desc { font-size: 11px; color: var(--text2); margin-top: 3px; }

  /* ========== GOAL PROGRESS INPUT ========== */
  .goal-progress-input {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 14px;
  }

  .goal-progress-input input[type="number"] {
    width: 70px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 6px 10px;
    color: var(--text);
    font-family: var(--font-mono);
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    outline: none;
    transition: border-color var(--transition);
  }

  .goal-progress-input input[type="number"]:focus { border-color: var(--accent); }
  .goal-progress-input input[type="number"]::-webkit-outer-spin-button,
  .goal-progress-input input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
</style>
</head>
<body>

<!-- BG Orbs -->
<div class="bg-orb bg-orb-1"></div>
<div class="bg-orb bg-orb-2"></div>
<div class="bg-orb bg-orb-3"></div>

<!-- ====== LOGIN OVERLAY ====== -->
<div class="login-overlay" id="loginOverlay">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-icon glow-pulse">âš¡</div>
      <div class="login-logo-text">My<span>Core</span></div>
    </div>
    <div class="login-tabs">
      <div class="login-tab active" onclick="switchLoginTab('login', this)">Entrar</div>
      <div class="login-tab" onclick="switchLoginTab('register', this)">Criar Conta</div>
    </div>

    <!-- Login Form -->
    <div class="login-form active" id="loginForm">
      <div class="login-title">Bem-vindo de volta ðŸ‘‹</div>
      <div class="login-sub">Acesse sua conta para continuar sua jornada</div>
      <div class="login-error" id="loginError"></div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-control" id="loginEmail" placeholder="seu@email.com" autocomplete="email">
      </div>
      <div class="form-group">
        <label class="form-label">Senha</label>
        <input type="password" class="form-control" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
      </div>
      <button class="login-btn" onclick="doLogin()">Entrar no MyCore</button>
    </div>

    <!-- Register Form -->
    <div class="login-form" id="registerForm">
      <div class="login-title">Criar sua conta ðŸš€</div>
      <div class="login-sub">Comece a transformar sua vida hoje mesmo</div>
      <div class="login-error" id="registerError"></div>
      <div class="login-success" id="registerSuccess"></div>
      <div class="form-group">
        <label class="form-label">Seu Nome</label>
        <input type="text" class="form-control" id="regName" placeholder="Como quer ser chamado?">
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-control" id="regEmail" placeholder="seu@email.com" autocomplete="email">
      </div>
      <div class="form-group">
        <label class="form-label">Senha</label>
        <input type="password" class="form-control" id="regPassword" placeholder="MÃ­nimo 6 caracteres" autocomplete="new-password">
      </div>
      <div class="form-group">
        <label class="form-label">Confirmar Senha</label>
        <input type="password" class="form-control" id="regConfirm" placeholder="Repita a senha">
      </div>
      <button class="login-btn" onclick="doRegister()">Criar Minha Conta</button>
    </div>
  </div>
</div>

<!-- SIDEBAR BACKDROP (mobile) -->
<div class="sidebar-backdrop" id="sidebarBackdrop" onclick="closeMobileSidebar()"></div>

<!-- SIDEBAR -->
<nav class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon glow-pulse">âš¡</div>
    <div class="logo-text">My<span>Core</span></div>
  </div>

  <div class="sidebar-nav">
    <div class="nav-label">Principal</div>
    <div class="nav-item active" data-page="dashboard">
      <i class="fas fa-th-large"></i>
      <span>Dashboard</span>
    </div>
    <div class="nav-item" data-page="financas">
      <i class="fas fa-wallet"></i>
      <span>FinanÃ§as</span>
    </div>

    <div class="nav-label">Crescimento</div>
    <div class="nav-item" data-page="metas">
      <i class="fas fa-bullseye"></i>
      <span>Metas & Objetivos</span>
      <span class="nav-badge" id="badge-metas">3</span>
    </div>
    <div class="nav-item" data-page="desenvolvimento">
      <i class="fas fa-seedling"></i>
      <span>Desenvolvimento</span>
    </div>
    <div class="nav-item" data-page="conquistas">
      <i class="fas fa-trophy"></i>
      <span>Conquistas</span>
    </div>

    <div class="nav-label">AnÃ¡lise</div>
    <div class="nav-item" data-page="relatorios">
      <i class="fas fa-chart-line"></i>
      <span>RelatÃ³rios</span>
    </div>
    <div class="nav-item" data-page="configuracoes">
      <i class="fas fa-cog"></i>
      <span>ConfiguraÃ§Ãµes</span>
    </div>
  </div>

  <div class="sidebar-footer">
    <button class="toggle-btn" id="sidebarToggle">
      <i class="fas fa-chevron-left" id="toggleIcon"></i>
      <span>Recolher menu</span>
    </button>
  </div>
</nav>

<!-- MAIN -->
<div class="main" id="main">

  <!-- TOPBAR -->
  <header class="topbar">
    <button class="hamburger" id="hamburgerBtn" onclick="openMobileSidebar()">
      <i class="fas fa-bars"></i>
    </button>
    <div class="topbar-title" id="topbarTitle">Dashboard</div>
    <div class="topbar-date" id="topbarDate"></div>
    <div class="topbar-score">
      <i class="fas fa-star" style="color: var(--accent2);"></i>
      <span style="font-size:13px; color: var(--text2);">Life Score:</span>
      <span class="score-badge" id="lifeScoreTop">78</span>
    </div>
    <button class="quick-add-btn" onclick="openModal('quick')">
      <i class="fas fa-plus"></i> LanÃ§amento RÃ¡pido
    </button>
  </header>

  <!-- CONTENT -->
  <main class="content">

    <!-- ====== DASHBOARD ====== -->
    <div class="page active" id="page-dashboard">
      <div class="section-title">Bom dia, <span style="color:var(--accent)">VocÃª</span> ðŸ‘‹</div>
      <div class="section-sub">Aqui estÃ¡ o resumo completo da sua vida. Tudo sob controle.</div>

      <!-- Score + Stats -->
      <div class="grid-4" style="margin-bottom: 20px;">
        <div class="card" style="grid-column: span 1;">
          <div class="card-header">
            <span class="card-title">Saldo Atual</span>
            <div class="card-icon" style="background: rgba(0,217,165,0.15); color: var(--accent3);"><i class="fas fa-dollar-sign"></i></div>
          </div>
          <div class="stat-value" style="color: var(--accent3);" id="dash-saldo">R$0</div>
          <div class="stat-label">Este mÃªs</div>
          <span class="stat-change up"><i class="fas fa-arrow-up"></i> 12.4%</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Receitas</span>
            <div class="card-icon" style="background: rgba(108,99,255,0.15); color: var(--accent);"><i class="fas fa-arrow-down"></i></div>
          </div>
          <div class="stat-value" style="color: var(--accent);" id="dash-receita">R$0</div>
          <div class="stat-label">Total entradas</div>
          <span class="stat-change up"><i class="fas fa-arrow-up"></i> 8.1%</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Despesas</span>
            <div class="card-icon" style="background: rgba(255,107,107,0.15); color: var(--accent4);"><i class="fas fa-arrow-up"></i></div>
          </div>
          <div class="stat-value" style="color: var(--accent4);" id="dash-despesa">R$0</div>
          <div class="stat-label">Total saÃ­das</div>
          <span class="stat-change down"><i class="fas fa-arrow-up"></i> 3.2%</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Metas Ativas</span>
            <div class="card-icon" style="background: rgba(240,180,41,0.15); color: var(--accent2);"><i class="fas fa-bullseye"></i></div>
          </div>
          <div class="stat-value" style="color: var(--accent2);" id="dash-metas">0</div>
          <div class="stat-label">Em andamento</div>
          <div style="margin-top: 12px; font-size: 12px; color: var(--text2);" id="dash-metas-pct">0% mÃ©dia de progresso</div>
        </div>
      </div>

      <!-- Life Score + Chart -->
      <div class="grid-2" style="margin-bottom: 20px;">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Life Scoreâ„¢</span>
            <div class="card-icon" style="background: rgba(240,180,41,0.15); color: var(--accent2);"><i class="fas fa-star"></i></div>
          </div>
          <div class="card-glow"></div>
          <div class="score-section">
            <div class="score-ring-wrap">
              <svg width="130" height="130" viewBox="0 0 130 130">
                <circle cx="65" cy="65" r="55" fill="none" stroke="var(--surface)" stroke-width="10"/>
                <circle cx="65" cy="65" r="55" fill="none" stroke="url(#scoreGrad)" stroke-width="10"
                  stroke-linecap="round" stroke-dasharray="345.4" stroke-dashoffset="75.9" id="scoreCircle"/>
                <defs>
                  <linearGradient id="scoreGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#F0B429"/>
                    <stop offset="100%" stop-color="#FFD700"/>
                  </linearGradient>
                </defs>
              </svg>
              <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
                <div style="font-family:var(--font-display);font-size:32px;color:var(--accent2);line-height:1;" id="scoreMainNum">78</div>
                <div style="font-size:11px;color:var(--text2);">de 100</div>
              </div>
            </div>
            <div class="score-details">
              <div class="score-sub">Sua pontuaÃ§Ã£o de vida combina saÃºde financeira + progresso pessoal.</div>
              <div class="score-items" id="scoreItems">
                <div class="score-item">
                  <div class="score-item-dot" style="background:var(--accent3)"></div>
                  <div class="score-item-label">SaÃºde Financeira</div>
                  <div class="score-item-val" style="color:var(--accent3)">85</div>
                </div>
                <div class="score-item">
                  <div class="score-item-dot" style="background:var(--accent)"></div>
                  <div class="score-item-label">Metas</div>
                  <div class="score-item-val" style="color:var(--accent)">72</div>
                </div>
                <div class="score-item">
                  <div class="score-item-dot" style="background:var(--accent2)"></div>
                  <div class="score-item-label">HÃ¡bitos</div>
                  <div class="score-item-val" style="color:var(--accent2)">80</div>
                </div>
                <div class="score-item">
                  <div class="score-item-dot" style="background:#FF9B9B"></div>
                  <div class="score-item-label">Desenvolvimento</div>
                  <div class="score-item-val" style="color:#FF9B9B">74</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Fluxo Financeiro</span>
          </div>
          <div class="chart-wrap" style="height:180px;">
            <canvas id="dashChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Recent + Habits Preview -->
      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Ãšltimas TransaÃ§Ãµes</span>
            <span style="font-size:12px;color:var(--accent);cursor:pointer" onclick="navigate('financas')">Ver todas â†’</span>
          </div>
          <div class="transaction-list" id="dashTransactions">
            <div class="empty-state"><div class="empty-state-icon">ðŸ’¸</div><h3>Sem transaÃ§Ãµes</h3><p>Adicione seu primeiro lanÃ§amento</p></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">HÃ¡bitos de Hoje</span>
            <span style="font-size:12px;color:var(--accent);cursor:pointer" onclick="navigate('desenvolvimento')">Ver todos â†’</span>
          </div>
          <div id="dashHabits">
            <div class="empty-state"><div class="empty-state-icon">ðŸŒ±</div><h3>Sem hÃ¡bitos</h3><p>Adicione hÃ¡bitos na aba Desenvolvimento</p></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ====== FINANÃ‡AS ====== -->
    <div class="page" id="page-financas">
      <div class="section-title">FinanÃ§as</div>
      <div class="section-sub">Controle completo das suas entradas, saÃ­das e investimentos.</div>

      <div style="display:flex; gap:10px; margin-bottom:24px;">
        <button class="btn btn-primary" onclick="openModal('receita')"><i class="fas fa-plus"></i> Receita</button>
        <button class="btn btn-ghost" onclick="openModal('despesa')"><i class="fas fa-minus"></i> Despesa</button>
        <button class="btn btn-ghost" onclick="openModal('investimento')"><i class="fas fa-chart-line"></i> Investimento</button>
      </div>

      <div class="grid-3" style="margin-bottom:20px;">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Total Receitas</span>
            <div class="card-icon" style="background:rgba(0,217,165,0.15);color:var(--accent3);"><i class="fas fa-arrow-down"></i></div>
          </div>
          <div class="stat-value" style="color:var(--accent3)" id="fin-receita">R$ 0,00</div>
          <div class="stat-label">Entradas do mÃªs</div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="card-title">Total Despesas</span>
            <div class="card-icon" style="background:rgba(255,107,107,0.15);color:var(--accent4);"><i class="fas fa-arrow-up"></i></div>
          </div>
          <div class="stat-value" style="color:var(--accent4)" id="fin-despesa">R$ 0,00</div>
          <div class="stat-label">SaÃ­das do mÃªs</div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="card-title">Saldo LÃ­quido</span>
            <div class="card-icon" style="background:rgba(108,99,255,0.15);color:var(--accent);"><i class="fas fa-balance-scale"></i></div>
          </div>
          <div class="stat-value" id="fin-saldo">R$ 0,00</div>
          <div class="stat-label">Resultado do perÃ­odo</div>
        </div>
      </div>

      <div class="grid-2" style="margin-bottom:20px;">
        <div class="card">
          <div class="card-header">
            <span class="card-title">EvoluÃ§Ã£o Mensal</span>
          </div>
          <div class="chart-wrap" style="height:200px;">
            <canvas id="finChart"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="card-title">Por Categoria</span>
          </div>
          <div class="chart-wrap" style="height:200px;">
            <canvas id="catChart"></canvas>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-title">Todas as TransaÃ§Ãµes</span>
          <div style="display:flex;gap:8px;">
            <select class="form-control" style="width:auto;padding:6px 12px;font-size:12px;" id="filterTipo">
              <option value="">Todos</option>
              <option value="receita">Receitas</option>
              <option value="despesa">Despesas</option>
              <option value="investimento">Investimentos</option>
            </select>
          </div>
        </div>
        <div class="transaction-list" id="allTransactions">
          <div class="empty-state"><div class="empty-state-icon">ðŸ’°</div><h3>Nenhuma transaÃ§Ã£o ainda</h3><p>Adicione sua primeira receita ou despesa</p></div>
        </div>
      </div>
    </div>

    <!-- ====== METAS ====== -->
    <div class="page" id="page-metas">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:28px;">
        <div>
          <div class="section-title">Metas & Objetivos</div>
          <div class="section-sub" style="margin-bottom:0">Seus sonhos com prazo e progresso.</div>
        </div>
        <button class="btn btn-primary" onclick="openModal('meta')"><i class="fas fa-plus"></i> Nova Meta</button>
      </div>

      <div class="grid-3" id="goalsGrid">
        <div class="card col-span-3">
          <div class="empty-state">
            <div class="empty-state-icon">ðŸŽ¯</div>
            <h3>Nenhuma meta criada</h3>
            <p>Crie sua primeira meta e comece a transformar sonhos em conquistas</p>
            <button class="btn btn-primary" style="margin-top:16px" onclick="openModal('meta')">Criar primeira meta</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ====== DESENVOLVIMENTO ====== -->
    <div class="page" id="page-desenvolvimento">
      <div class="section-title">Desenvolvimento Pessoal</div>
      <div class="section-sub">HÃ¡bitos, habilidades, aprendizados. Quem vocÃª estÃ¡ se tornando.</div>

      <div class="grid-2" style="margin-bottom:20px;">
        <div class="card">
          <div class="card-header">
            <span class="card-title">HÃ¡bitos DiÃ¡rios</span>
            <button class="btn btn-ghost" style="padding:6px 14px;font-size:12px;" onclick="openModal('habito')"><i class="fas fa-plus"></i> Novo</button>
          </div>
          <div id="habitsContainer">
            <div class="empty-state"><div class="empty-state-icon">ðŸŒ±</div><h3>Sem hÃ¡bitos</h3><p>Adicione hÃ¡bitos para rastrear seu crescimento diÃ¡rio</p></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Perfil de EquilÃ­brio</span>
          </div>
          <div class="radar-section">
            <div style="width:220px;flex-shrink:0;">
              <canvas id="radarChart" width="220" height="220"></canvas>
            </div>
            <div class="radar-labels" id="radarLabels">
              <div class="radar-label-item"><div class="radar-dot" style="background:#6C63FF"></div><div class="radar-label-name">FinanÃ§as</div><div class="radar-label-val" style="color:#6C63FF" id="rad-fin">85</div></div>
              <div class="radar-label-item"><div class="radar-dot" style="background:#F0B429"></div><div class="radar-label-name">Carreira</div><div class="radar-label-val" style="color:#F0B429" id="rad-car">72</div></div>
              <div class="radar-label-item"><div class="radar-dot" style="background:#00D9A5"></div><div class="radar-label-name">SaÃºde</div><div class="radar-label-val" style="color:#00D9A5" id="rad-sau">78</div></div>
              <div class="radar-label-item"><div class="radar-dot" style="background:#FF6B6B"></div><div class="radar-label-name">Relacionamentos</div><div class="radar-label-val" style="color:#FF6B6B" id="rad-rel">65</div></div>
              <div class="radar-label-item"><div class="radar-dot" style="background:#9B8FFF"></div><div class="radar-label-name">Conhecimento</div><div class="radar-label-val" style="color:#9B8FFF" id="rad-con">80</div></div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Habilidades</span>
            <button class="btn btn-ghost" style="padding:6px 14px;font-size:12px;" onclick="openModal('habilidade')"><i class="fas fa-plus"></i> Adicionar</button>
          </div>
          <div id="skillsContainer">
            <div class="empty-state"><div class="empty-state-icon">âš¡</div><h3>Sem habilidades</h3><p>Adicione e acompanhe seu nÃ­vel em cada habilidade</p></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">DiÃ¡rio de Aprendizados</span>
            <button class="btn btn-ghost" style="padding:6px 14px;font-size:12px;" onclick="openModal('diario')"><i class="fas fa-pen"></i> Escrever</button>
          </div>
          <div id="diaryContainer">
            <div class="empty-state"><div class="empty-state-icon">ðŸ“–</div><h3>DiÃ¡rio vazio</h3><p>Registre o que vocÃª aprendeu hoje</p></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ====== CONQUISTAS ====== -->
    <div class="page" id="page-conquistas">
      <div class="section-title">Conquistas</div>
      <div class="section-sub">Seu hall da fama pessoal. Cada trofÃ©u, um capÃ­tulo da sua histÃ³ria.</div>

      <div class="achievement-grid" id="achievementsGrid"></div>
    </div>

    <!-- ====== RELATÃ“RIOS ====== -->
    <div class="page" id="page-relatorios">
      <div class="section-title">RelatÃ³rios</div>
      <div class="section-sub">VisÃ£o histÃ³rica e anÃ¡lise completa da sua evoluÃ§Ã£o.</div>

      <div class="grid-2" style="margin-bottom:20px;">
        <div class="card">
          <div class="card-header">
            <span class="card-title">EvoluÃ§Ã£o do Life Score</span>
          </div>
          <div class="chart-wrap" style="height:200px;">
            <canvas id="scoreChart"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="card-title">Fluxo de Caixa â€” 12 meses</span>
          </div>
          <div class="chart-wrap" style="height:200px;">
            <canvas id="cashflowChart"></canvas>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-title">Exportar RelatÃ³rios</span>
        </div>
        <div class="report-card" onclick="openExportModal('financeiro')">
          <div class="report-icon">ðŸ“Š</div>
          <div class="report-info">
            <div class="report-name">RelatÃ³rio Financeiro Completo</div>
            <div class="report-desc">Receitas, despesas, investimentos e saldo â€” resumo executivo</div>
          </div>
          <div class="report-arrow"><i class="fas fa-download"></i></div>
        </div>
        <div class="report-card" onclick="openExportModal('metas')">
          <div class="report-icon">ðŸŽ¯</div>
          <div class="report-info">
            <div class="report-name">RelatÃ³rio de Metas</div>
            <div class="report-desc">Progresso, conquistas e objetivos em andamento</div>
          </div>
          <div class="report-arrow"><i class="fas fa-download"></i></div>
        </div>
        <div class="report-card" onclick="openExportModal('desenvolvimento')">
          <div class="report-icon">ðŸŒ±</div>
          <div class="report-info">
            <div class="report-name">RelatÃ³rio de Desenvolvimento</div>
            <div class="report-desc">HÃ¡bitos, habilidades, diÃ¡rio e evoluÃ§Ã£o pessoal</div>
          </div>
          <div class="report-arrow"><i class="fas fa-download"></i></div>
        </div>
        <div class="report-card" onclick="openExportModal('completo')">
          <div class="report-icon">âš¡</div>
          <div class="report-info">
            <div class="report-name">RelatÃ³rio de Vida Completo</div>
            <div class="report-desc">Tudo em um sÃ³ documento â€” o retrato completo de vocÃª</div>
          </div>
          <div class="report-arrow"><i class="fas fa-download"></i></div>
        </div>
      </div>
    </div>

    <!-- ====== CONFIGURAÃ‡Ã•ES ====== -->
    <div class="page" id="page-configuracoes">
      <div class="section-title">ConfiguraÃ§Ãµes</div>
      <div class="section-sub">Personalize sua experiÃªncia no MyCore.</div>

      <!-- Profile -->
      <div class="profile-hero">
        <div class="profile-avatar" id="avatarDisplay" onclick="openModal('perfil')">V</div>
        <div>
          <div class="profile-name" id="profileName">VocÃª</div>
          <div class="profile-phrase" id="profilePhrase">"A disciplina Ã© a ponte entre objetivos e conquistas."</div>
          <div class="profile-since">Membro desde <span id="memberSince"></span></div>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-title" style="margin-bottom:20px;">Perfil</div>
          <div class="form-group">
            <label class="form-label">Seu Nome</label>
            <input type="text" class="form-control" id="configName" placeholder="Como quer ser chamado?" oninput="updateProfile()">
          </div>
          <div class="form-group">
            <label class="form-label">Frase Pessoal</label>
            <input type="text" class="form-control" id="configPhrase" placeholder="Sua frase motivacional" oninput="updateProfile()">
          </div>
          <div class="form-group">
            <label class="form-label">Meta de Economia Mensal</label>
            <input type="number" class="form-control" id="configMeta" placeholder="R$ 0,00">
          </div>
          <button class="btn btn-primary" onclick="saveConfig()">Salvar Perfil</button>
        </div>

        <div class="card">
          <div class="card-title" style="margin-bottom:20px;">PreferÃªncias</div>
          <div class="toggle-wrap">
            <div><div class="toggle-label">NotificaÃ§Ãµes diÃ¡rias</div><div class="toggle-desc">Lembrete para registrar gastos</div></div>
            <div class="toggle on" onclick="this.classList.toggle('on')"></div>
          </div>
          <div class="toggle-wrap">
            <div><div class="toggle-label">RelatÃ³rio semanal</div><div class="toggle-desc">Resumo automÃ¡tico todo domingo</div></div>
            <div class="toggle on" onclick="this.classList.toggle('on')"></div>
          </div>
          <div class="toggle-wrap">
            <div><div class="toggle-label">Alertas de gasto</div><div class="toggle-desc">Notifica ao ultrapassar categoria</div></div>
            <div class="toggle" onclick="this.classList.toggle('on')"></div>
          </div>
          <div class="toggle-wrap">
            <div><div class="toggle-label">Streak de hÃ¡bitos</div><div class="toggle-desc">Mostra sequÃªncia de dias</div></div>
            <div class="toggle on" onclick="this.classList.toggle('on')"></div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:20px;">
        <div class="card-title" style="margin-bottom:20px;">Dados & SeguranÃ§a</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button class="btn btn-ghost" onclick="exportData()"><i class="fas fa-download"></i> Exportar dados JSON</button>
          <button class="btn btn-ghost" style="color:var(--accent4);" onclick="if(confirm('Tem certeza? Isso apagarÃ¡ tudo!')) clearData()"><i class="fas fa-trash"></i> Limpar todos os dados</button>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- ====== MODALS ====== -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal" id="modal-content"></div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <span class="toast-icon" id="toast-icon">âœ…</span>
  <span id="toast-msg">Salvo com sucesso!</span>
</div>

<script>
// ============================================================
// AUTH SYSTEM
// ============================================================
function getUsers() {
  try { return JSON.parse(localStorage.getItem('mycore_users') || '{}'); } catch(e) { return {}; }
}

function saveUsers(users) {
  localStorage.setItem('mycore_users', JSON.stringify(users));
}

function getCurrentUser() {
  return localStorage.getItem('mycore_current_user') || null;
}

function setCurrentUser(email) {
  localStorage.setItem('mycore_current_user', email);
}

function logoutUser() {
  localStorage.removeItem('mycore_current_user');
  location.reload();
}

function getUserDataKey(email) {
  return 'mycore_data_' + email.replace(/[^a-zA-Z0-9]/g, '_');
}

function switchLoginTab(tab, el) {
  document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(tab === 'login' ? 'loginForm' : 'registerForm').classList.add('active');
  document.getElementById('loginError').style.display = 'none';
  document.getElementById('registerError').style.display = 'none';
}

function showLoginError(id, msg) {
  const el = document.getElementById(id);
  el.textContent = msg;
  el.style.display = 'block';
}

function doLogin() {
  const email = document.getElementById('loginEmail').value.trim().toLowerCase();
  const pass = document.getElementById('loginPassword').value;
  const err = document.getElementById('loginError');
  err.style.display = 'none';

  if(!email || !pass) { showLoginError('loginError', 'Preencha todos os campos.'); return; }

  const users = getUsers();
  if(!users[email]) { showLoginError('loginError', 'Email nÃ£o encontrado. Crie uma conta!'); return; }
  if(users[email].password !== btoa(pass)) { showLoginError('loginError', 'Senha incorreta. Tente novamente.'); return; }

  setCurrentUser(email);
  loadUserSession(email);
  document.getElementById('loginOverlay').classList.add('hidden');
  setTimeout(() => { document.getElementById('loginOverlay').style.display = 'none'; }, 500);
  showToast(`Bem-vindo de volta, ${users[email].name}! ðŸ‘‹`, 'ðŸš€');
}

function doRegister() {
  const name = document.getElementById('regName').value.trim();
  const email = document.getElementById('regEmail').value.trim().toLowerCase();
  const pass = document.getElementById('regPassword').value;
  const conf = document.getElementById('regConfirm').value;
  const err = document.getElementById('registerError');
  const suc = document.getElementById('registerSuccess');
  err.style.display = 'none';
  suc.style.display = 'none';

  if(!name || !email || !pass) { showLoginError('registerError', 'Preencha todos os campos.'); return; }
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { showLoginError('registerError', 'Email invÃ¡lido.'); return; }
  if(pass.length < 6) { showLoginError('registerError', 'Senha deve ter pelo menos 6 caracteres.'); return; }
  if(pass !== conf) { showLoginError('registerError', 'As senhas nÃ£o coincidem.'); return; }

  const users = getUsers();
  if(users[email]) { showLoginError('registerError', 'Este email jÃ¡ estÃ¡ cadastrado.'); return; }

  users[email] = { name, email, password: btoa(pass), createdAt: new Date().toISOString() };
  saveUsers(users);
  setCurrentUser(email);

  // Initialize fresh data for new user
  data = {
    transactions: [], goals: [], habits: [], skills: [], diary: [],
    config: {
      name,
      phrase: '"A disciplina Ã© a ponte entre objetivos e conquistas."',
      metaMensal: 0,
      memberSince: new Date().toLocaleDateString('pt-BR', {month:'long',year:'numeric'})
    },
    radarValues: { fin:50, car:50, sau:50, rel:50, con:50 }
  };
  saveData();

  document.getElementById('loginOverlay').classList.add('hidden');
  setTimeout(() => { document.getElementById('loginOverlay').style.display = 'none'; }, 500);
  showToast(`Bem-vindo ao MyCore, ${name}! ðŸš€`, 'ðŸŽ‰');
  refreshAll();
}

function loadUserSession(email) {
  const key = getUserDataKey(email);
  const saved = localStorage.getItem(key);
  if(saved) {
    try { data = { ...data, ...JSON.parse(saved) }; } catch(e) {}
  }
  refreshAll();
}

function checkAuth() {
  const user = getCurrentUser();
  if(user) {
    const users = getUsers();
    if(users[user]) {
      loadUserSession(user);
      document.getElementById('loginOverlay').style.display = 'none';
      return true;
    }
  }
  return false;
}

// ============================================================
// DATA LAYER
// ============================================================
let data = {
  transactions: [],
  goals: [],
  habits: [],
  skills: [],
  diary: [],
  config: {
    name: 'VocÃª',
    phrase: '"A disciplina Ã© a ponte entre objetivos e conquistas."',
    metaMensal: 0,
    memberSince: new Date().toLocaleDateString('pt-BR', {month:'long',year:'numeric'})
  },
  radarValues: { fin:85, car:72, sau:78, rel:65, con:80 }
};

// Load from localStorage (user-specific)
function loadData() {
  const user = getCurrentUser();
  if(!user) return;
  const key = getUserDataKey(user);
  const saved = localStorage.getItem(key);
  if(saved) {
    try { data = { ...data, ...JSON.parse(saved) }; } catch(e) {}
  }
}

function saveData() {
  const user = getCurrentUser();
  if(user) {
    localStorage.setItem(getUserDataKey(user), JSON.stringify(data));
  } else {
    localStorage.setItem('mycore_data', JSON.stringify(data));
  }
  refreshAll();
}

// ============================================================
// NAVIGATION
// ============================================================
const pageNames = {
  dashboard: 'Dashboard',
  financas: 'FinanÃ§as',
  metas: 'Metas & Objetivos',
  desenvolvimento: 'Desenvolvimento Pessoal',
  conquistas: 'Conquistas',
  relatorios: 'RelatÃ³rios',
  configuracoes: 'ConfiguraÃ§Ãµes'
};

function navigate(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  
  document.getElementById('page-' + page).classList.add('active');
  document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
  document.getElementById('topbarTitle').textContent = pageNames[page] || page;

  // Scroll to top smoothly
  const content = document.querySelector('.content');
  if(content) content.scrollTo({ top: 0, behavior: 'smooth' });
  
  if(page === 'conquistas') renderAchievements();
  if(page === 'relatorios') setTimeout(initReportCharts, 100);

  // Close mobile sidebar if open
  closeMobileSidebar();
}

document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => navigate(item.dataset.page));
});

// ============================================================
// MOBILE SIDEBAR
// ============================================================
function openMobileSidebar() {
  document.getElementById('sidebar').classList.add('mobile-open');
  document.getElementById('sidebarBackdrop').classList.add('show');
}

function closeMobileSidebar() {
  document.getElementById('sidebar').classList.remove('mobile-open');
  document.getElementById('sidebarBackdrop').classList.remove('show');
}

// ============================================================
// SIDEBAR TOGGLE (desktop)
// ============================================================
document.getElementById('sidebarToggle').addEventListener('click', () => {
  const sb = document.getElementById('sidebar');
  const mn = document.getElementById('main');
  const ic = document.getElementById('toggleIcon');
  sb.classList.toggle('collapsed');
  mn.classList.toggle('expanded');
  ic.style.transform = sb.classList.contains('collapsed') ? 'rotate(180deg)' : '';
});

// ============================================================
// SMOOTH SCROLL
// ============================================================
(function() {
  const content = document.querySelector('.content');
  if(!content) return;
  let isScrolling = false;
  let scrollTarget = 0;
  let currentScroll = 0;

  content.addEventListener('wheel', function(e) {
    e.preventDefault();
    scrollTarget += e.deltaY * 0.8;
    scrollTarget = Math.max(0, Math.min(scrollTarget, content.scrollHeight - content.clientHeight));
    if(!isScrolling) smoothScroll();
  }, { passive: false });

  function smoothScroll() {
    isScrolling = true;
    currentScroll = content.scrollTop;
    const diff = scrollTarget - currentScroll;
    if(Math.abs(diff) < 0.5) {
      content.scrollTop = scrollTarget;
      isScrolling = false;
      return;
    }
    content.scrollTop += diff * 0.12;
    requestAnimationFrame(smoothScroll);
  }
})();

// ============================================================
// TOPBAR DATE
// ============================================================
function updateDate() {
  const now = new Date();
  const opts = { weekday:'long', day:'numeric', month:'long', year:'numeric' };
  document.getElementById('topbarDate').textContent = now.toLocaleDateString('pt-BR', opts);
}
updateDate();

// ============================================================
// MODAL SYSTEM
// ============================================================
function openModal(type, extraData = {}) {
  const overlay = document.getElementById('modal-overlay');
  const content = document.getElementById('modal-content');
  content.innerHTML = getModalContent(type, extraData);
  overlay.classList.add('open');
}

function closeModal(e) {
  if(e && e.target !== document.getElementById('modal-overlay')) return;
  document.getElementById('modal-overlay').classList.remove('open');
}

function closeModalDirect() {
  document.getElementById('modal-overlay').classList.remove('open');
}

function getModalContent(type, extra) {
  const templates = {
    quick: `
      <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
      <div class="modal-title">âš¡ LanÃ§amento RÃ¡pido</div>
      <div class="chip-select" style="margin-bottom:20px;" id="quickTypeChips">
        <div class="chip selected" onclick="selectChip(this,'quickTypeChips')">ðŸ’° Receita</div>
        <div class="chip" onclick="selectChip(this,'quickTypeChips')">ðŸ’¸ Despesa</div>
        <div class="chip" onclick="selectChip(this,'quickTypeChips')">ðŸ“ˆ Investimento</div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Valor</label>
          <input type="number" class="form-control" id="qVal" placeholder="R$ 0,00">
        </div>
        <div class="form-group">
          <label class="form-label">Data</label>
          <input type="date" class="form-control" id="qDate" value="${new Date().toISOString().split('T')[0]}">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">DescriÃ§Ã£o</label>
        <input type="text" class="form-control" id="qDesc" placeholder="Ex: Aluguel, SalÃ¡rio...">
      </div>
      <div class="form-group">
        <label class="form-label">Categoria</label>
        <select class="form-control" id="qCat">
          <option>ðŸ  Moradia</option><option>ðŸ” AlimentaÃ§Ã£o</option><option>ðŸš— Transporte</option>
          <option>ðŸ’¼ Trabalho/SalÃ¡rio</option><option>ðŸ¥ SaÃºde</option><option>ðŸ“š EducaÃ§Ã£o</option>
          <option>ðŸŽ‰ Lazer</option><option>ðŸ’³ DÃ­vidas</option><option>ðŸ“ˆ Investimento</option><option>ðŸ”§ Outros</option>
        </select>
      </div>
      <div class="btn-row">
        <button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button>
        <button class="btn btn-primary" onclick="saveTransaction('quick')">Registrar</button>
      </div>`,

    receita: `
      <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
      <div class="modal-title">ðŸ’° Nova Receita</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Valor</label><input type="number" class="form-control" id="rVal" placeholder="0,00"></div>
        <div class="form-group"><label class="form-label">Data</label><input type="date" class="form-control" id="rDate" value="${new Date().toISOString().split('T')[0]}"></div>
      </div>
      <div class="form-group"><label class="form-label">DescriÃ§Ã£o</label><input type="text" class="form-control" id="rDesc" placeholder="Ex: SalÃ¡rio, Freelance..."></div>
      <div class="form-group"><label class="form-label">Categoria</label>
        <select class="form-control" id="rCat"><option>ðŸ’¼ SalÃ¡rio</option><option>ðŸ’» Freelance</option><option>ðŸ“ˆ Investimento</option><option>ðŸŽ Presente</option><option>ðŸ”§ Outros</option></select></div>
      <div class="btn-row"><button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button><button class="btn btn-primary" onclick="saveTransaction('receita')">Salvar</button></div>`,

    despesa: `
      <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
      <div class="modal-title">ðŸ’¸ Nova Despesa</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Valor</label><input type="number" class="form-control" id="dVal" placeholder="0,00"></div>
        <div class="form-group"><label class="form-label">Data</label><input type="date" class="form-control" id="dDate" value="${new Date().toISOString().split('T')[0]}"></div>
      </div>
      <div class="form-group"><label class="form-label">DescriÃ§Ã£o</label><input type="text" class="form-control" id="dDesc" placeholder="Ex: Aluguel, Mercado..."></div>
      <div class="form-group"><label class="form-label">Categoria</label>
        <select class="form-control" id="dCat"><option>ðŸ  Moradia</option><option>ðŸ” AlimentaÃ§Ã£o</option><option>ðŸš— Transporte</option><option>ðŸ¥ SaÃºde</option><option>ðŸ“š EducaÃ§Ã£o</option><option>ðŸŽ‰ Lazer</option><option>ðŸ’³ DÃ­vidas</option><option>ðŸ”§ Outros</option></select></div>
      <div class="btn-row"><button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button><button class="btn btn-primary" onclick="saveTransaction('despesa')">Salvar</button></div>`,

    investimento: `
      <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
      <div class="modal-title">ðŸ“ˆ Novo Investimento</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Valor Aportado</label><input type="number" class="form-control" id="iVal" placeholder="0,00"></div>
        <div class="form-group"><label class="form-label">Data</label><input type="date" class="form-control" id="iDate" value="${new Date().toISOString().split('T')[0]}"></div>
      </div>
      <div class="form-group"><label class="form-label">Ativo / DescriÃ§Ã£o</label><input type="text" class="form-control" id="iDesc" placeholder="Ex: Tesouro Direto, CDB, AÃ§Ãµes..."></div>
      <div class="form-group"><label class="form-label">Tipo</label>
        <select class="form-control" id="iCat"><option>ðŸ¦ Renda Fixa</option><option>ðŸ“Š AÃ§Ãµes</option><option>â‚¿ Cripto</option><option>ðŸ¢ FII</option><option>ðŸŒ Internacional</option><option>ðŸ”§ Outros</option></select></div>
      <div class="btn-row"><button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button><button class="btn btn-primary" onclick="saveTransaction('investimento')">Salvar</button></div>`,

    meta: `
      <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
      <div class="modal-title">ðŸŽ¯ Nova Meta</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Nome da Meta</label><input type="text" class="form-control" id="gName" placeholder="Ex: Comprar carro, Viajar..."></div>
        <div class="form-group"><label class="form-label">Emoji</label><input type="text" class="form-control" id="gEmoji" placeholder="ðŸŽ¯" maxlength="2"></div>
      </div>
      <div class="form-group"><label class="form-label">DescriÃ§Ã£o</label><input type="text" class="form-control" id="gDesc" placeholder="Descreva sua meta..."></div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Valor Alvo (R$)</label><input type="number" class="form-control" id="gTarget" placeholder="0 para meta nÃ£o financeira"></div>
        <div class="form-group"><label class="form-label">Prazo</label><input type="date" class="form-control" id="gDeadline"></div>
      </div>
      <div class="form-group"><label class="form-label">Progresso Atual (%)</label>
        <div style="display:flex;align-items:center;gap:12px;margin-top:8px;">
          <input type="range" id="gProgress" min="0" max="100" value="0" oninput="syncProgressInput(this.value,'gProgressNum')" style="flex:1;accent-color:var(--accent)">
          <input type="number" id="gProgressNum" min="0" max="100" value="0" oninput="syncProgressSlider(this.value,'gProgress')" style="width:65px;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:6px 8px;color:var(--text);font-family:var(--font-mono);font-weight:600;text-align:center;outline:none;font-size:14px;">
          <span style="color:var(--accent);font-family:var(--font-mono)">%</span>
        </div>
      </div>
      <div class="btn-row"><button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button><button class="btn btn-primary" onclick="saveMeta()">Criar Meta</button></div>`,

    habito: `
      <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
      <div class="modal-title">ðŸŒ± Novo HÃ¡bito</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Nome do HÃ¡bito</label><input type="text" class="form-control" id="hName" placeholder="Ex: ExercÃ­cio, Leitura..."></div>
        <div class="form-group"><label class="form-label">Emoji</label><input type="text" class="form-control" id="hEmoji" placeholder="ðŸƒ" maxlength="2"></div>
      </div>
      <div class="form-group"><label class="form-label">Categoria</label>
        <select class="form-control" id="hCat"><option>ðŸ’ª SaÃºde</option><option>ðŸ§  Conhecimento</option><option>ðŸ’¼ Trabalho</option><option>ðŸ§˜ Bem-estar</option><option>ðŸ’° Financeiro</option><option>ðŸ”§ Outros</option></select></div>
      <div class="btn-row"><button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button><button class="btn btn-primary" onclick="saveHabit()">Criar HÃ¡bito</button></div>`,

    habilidade: `
      <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
      <div class="modal-title">âš¡ Nova Habilidade</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-control" id="skName" placeholder="Ex: Python, Design..."></div>
        <div class="form-group"><label class="form-label">Emoji</label><input type="text" class="form-control" id="skEmoji" placeholder="ðŸ’»" maxlength="2"></div>
      </div>
      <div class="form-group"><label class="form-label">NÃ­vel Atual (0â€“100)</label>
        <div style="display:flex;align-items:center;gap:12px;margin-top:8px;">
          <input type="range" id="skLevel" min="0" max="100" value="30" oninput="syncProgressInput(this.value,'skLevelNum')" style="flex:1;accent-color:var(--accent)">
          <input type="number" id="skLevelNum" min="0" max="100" value="30" oninput="syncProgressSlider(this.value,'skLevel')" style="width:65px;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:6px 8px;color:var(--text);font-family:var(--font-mono);font-weight:600;text-align:center;outline:none;font-size:14px;">
        </div>
      </div>
      <div class="btn-row"><button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button><button class="btn btn-primary" onclick="saveSkill()">Salvar</button></div>`,

    diario: `
      <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
      <div class="modal-title">ðŸ“– DiÃ¡rio de Hoje</div>
      <div class="form-group">
        <label class="form-label">O que vocÃª aprendeu ou conquistou hoje?</label>
        <textarea class="form-control" id="diaryText" rows="6" placeholder="Escreva seus aprendizados, insights, vitÃ³rias do dia..."></textarea>
      </div>
      <div class="btn-row"><button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button><button class="btn btn-primary" onclick="saveDiary()">Salvar Registro</button></div>`,

    perfil: `
      <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
      <div class="modal-title">ðŸ‘¤ Editar Perfil</div>
      <div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-control" id="mName" value="${data.config.name}" placeholder="Seu nome"></div>
      <div class="form-group"><label class="form-label">Frase Motivacional</label><input type="text" class="form-control" id="mPhrase" value="${data.config.phrase}" placeholder="Sua frase"></div>
      <div class="btn-row"><button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button><button class="btn btn-primary" onclick="saveProfileModal()">Salvar</button></div>`,
  };
  return templates[type] || '<p>Modal nÃ£o encontrado</p>';
}

function syncProgressInput(val, targetId) {
  const el = document.getElementById(targetId);
  if(el) el.value = val;
}

function syncProgressSlider(val, targetId) {
  const v = Math.max(0, Math.min(100, parseInt(val) || 0));
  const el = document.getElementById(targetId);
  if(el) el.value = v;
}

function selectChip(el, groupId) {
  document.querySelectorAll(`#${groupId} .chip`).forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
}

// ============================================================
// TRANSACTIONS
// ============================================================
const txIcons = {
  receita: { icon: 'ðŸ’°', color: 'rgba(0,217,165,0.15)' },
  despesa: { icon: 'ðŸ’¸', color: 'rgba(255,107,107,0.15)' },
  investimento: { icon: 'ðŸ“ˆ', color: 'rgba(108,99,255,0.15)' }
};

function saveTransaction(type) {
  let val, date, desc, cat, txType;

  if(type === 'quick') {
    const chip = document.querySelector('#quickTypeChips .chip.selected')?.textContent || '';
    txType = chip.includes('Receita') ? 'receita' : chip.includes('Despesa') ? 'despesa' : 'investimento';
    val = parseFloat(document.getElementById('qVal')?.value);
    date = document.getElementById('qDate')?.value;
    desc = document.getElementById('qDesc')?.value;
    cat = document.getElementById('qCat')?.value;
  } else if(type === 'receita') {
    txType = 'receita';
    val = parseFloat(document.getElementById('rVal')?.value);
    date = document.getElementById('rDate')?.value;
    desc = document.getElementById('rDesc')?.value;
    cat = document.getElementById('rCat')?.value;
  } else if(type === 'despesa') {
    txType = 'despesa';
    val = parseFloat(document.getElementById('dVal')?.value);
    date = document.getElementById('dDate')?.value;
    desc = document.getElementById('dDesc')?.value;
    cat = document.getElementById('dCat')?.value;
  } else if(type === 'investimento') {
    txType = 'investimento';
    val = parseFloat(document.getElementById('iVal')?.value);
    date = document.getElementById('iDate')?.value;
    desc = document.getElementById('iDesc')?.value;
    cat = document.getElementById('iCat')?.value;
  }

  if(!val || val <= 0) { showToast('Informe um valor vÃ¡lido!', 'âš ï¸'); return; }
  if(!desc?.trim()) { showToast('Informe uma descriÃ§Ã£o!', 'âš ï¸'); return; }

  data.transactions.unshift({ id: Date.now(), type: txType, val, date, desc, cat });
  saveData();
  closeModalDirect();
  showToast('TransaÃ§Ã£o registrada!', txIcons[txType]?.icon || 'âœ…');
}

function renderTransactions(list, containerId, limit = 0) {
  const el = document.getElementById(containerId);
  if(!el) return;
  const items = limit ? list.slice(0, limit) : list;
  if(!items.length) {
    el.innerHTML = `<div class="empty-state"><div class="empty-state-icon">ðŸ’°</div><h3>Nenhuma transaÃ§Ã£o ainda</h3><p>Adicione sua primeira receita ou despesa</p></div>`;
    return;
  }
  el.innerHTML = items.map(t => {
    const ic = txIcons[t.type] || txIcons.despesa;
    const isIncome = t.type === 'receita';
    const isInvest = t.type === 'investimento';
    return `
    <div class="transaction-item">
      <div class="tx-icon" style="background:${ic.color}">${ic.icon}</div>
      <div class="tx-info">
        <div class="tx-name">${t.desc}</div>
        <div class="tx-category">${t.cat || ''}</div>
      </div>
      <div class="tx-date">${t.date ? new Date(t.date+'T12:00:00').toLocaleDateString('pt-BR') : ''}</div>
      <div class="tx-amount ${isIncome?'income':isInvest?'':' expense'}">${isIncome?'+':isInvest?'':'âˆ’'}${fmtCurrency(t.val)}</div>
    </div>`;
  }).join('');
}

// ============================================================
// GOALS â€” Auto-progress with number input
// ============================================================
function saveMeta() {
  const name = document.getElementById('gName')?.value;
  const emoji = document.getElementById('gEmoji')?.value || 'ðŸŽ¯';
  const desc = document.getElementById('gDesc')?.value;
  const target = parseFloat(document.getElementById('gTarget')?.value) || 0;
  const deadline = document.getElementById('gDeadline')?.value;
  const progress = parseInt(document.getElementById('gProgressNum')?.value || document.getElementById('gProgress')?.value) || 0;
  if(!name) { showToast('Informe o nome da meta!', 'âš ï¸'); return; }
  data.goals.push({ id: Date.now(), name, emoji, desc, target, deadline, progress: Math.min(100, Math.max(0, progress)) });
  saveData();
  closeModalDirect();
  showToast('Meta criada! ðŸŽ¯', 'ðŸš€');
}

function updateGoalProgress(id, val) {
  const goal = data.goals.find(g => g.id === id);
  if(goal) {
    goal.progress = Math.min(100, Math.max(0, parseInt(val) || 0));
    saveData();
  }
}

function deleteGoal(id) {
  if(!confirm('Remover esta meta?')) return;
  data.goals = data.goals.filter(g => g.id !== id);
  saveData();
}

function renderGoals() {
  const grid = document.getElementById('goalsGrid');
  if(!grid) return;
  if(!data.goals.length) {
    grid.innerHTML = `<div class="card col-span-3"><div class="empty-state"><div class="empty-state-icon">ðŸŽ¯</div><h3>Nenhuma meta criada</h3><p>Crie sua primeira meta e comece a transformar sonhos em conquistas</p><button class="btn btn-primary" style="margin-top:16px" onclick="openModal('meta')">Criar primeira meta</button></div></div>`;
    return;
  }
  grid.innerHTML = data.goals.map(g => {
    const daysLeft = g.deadline ? Math.ceil((new Date(g.deadline) - new Date()) / 86400000) : null;
    const pctColor = g.progress >= 80 ? 'green' : g.progress >= 50 ? '' : 'red';
    const progressColor = g.progress >= 80 ? 'var(--accent3)' : g.progress >= 50 ? 'var(--accent)' : 'var(--accent4)';
    return `
    <div class="goal-card">
      <div class="goal-emoji">${g.emoji}</div>
      <div class="goal-name">${g.name}</div>
      <div class="goal-desc">${g.desc || ''}</div>
      <div class="progress-bar-wrap"><div class="progress-bar ${pctColor}" style="width:${g.progress}%" id="pbar-${g.id}"></div></div>
      <div class="goal-nums">
        <span>${daysLeft !== null ? (daysLeft > 0 ? daysLeft + ' dias restantes' : 'Prazo vencido') : 'Sem prazo'}</span>
        <span class="goal-percent" style="color:${progressColor}" id="ppct-${g.id}">${g.progress}%</span>
      </div>
      <div class="goal-progress-input">
        <input type="range" min="0" max="100" value="${g.progress}" style="flex:1;accent-color:var(--accent)"
          oninput="liveGoalUpdate(${g.id}, this.value); syncGN(${g.id}, this.value)"
          onchange="updateGoalProgress(${g.id}, this.value)" id="pslider-${g.id}">
        <input type="number" min="0" max="100" value="${g.progress}" id="pnum-${g.id}"
          oninput="syncGS(${g.id},this.value); liveGoalUpdate(${g.id},this.value)"
          onchange="updateGoalProgress(${g.id}, this.value)">
        <span style="color:var(--text2);font-size:12px;font-family:var(--font-mono)">%</span>
        <button onclick="deleteGoal(${g.id})" style="background:none;border:none;color:var(--text3);cursor:pointer;font-size:13px;padding:4px;"><i class="fas fa-trash"></i></button>
      </div>
    </div>`;
  }).join('');
}

function liveGoalUpdate(id, val) {
  const v = Math.min(100, Math.max(0, parseInt(val) || 0));
  const bar = document.getElementById('pbar-' + id);
  const pct = document.getElementById('ppct-' + id);
  if(bar) bar.style.width = v + '%';
  if(pct) {
    pct.textContent = v + '%';
    pct.style.color = v >= 80 ? 'var(--accent3)' : v >= 50 ? 'var(--accent)' : 'var(--accent4)';
  }
}

function syncGN(id, val) {
  const el = document.getElementById('pnum-' + id);
  if(el) el.value = val;
}

function syncGS(id, val) {
  const v = Math.min(100, Math.max(0, parseInt(val) || 0));
  const el = document.getElementById('pslider-' + id);
  if(el) el.value = v;
}

// ============================================================
// HABITS
// ============================================================
function saveHabit() {
  const name = document.getElementById('hName')?.value;
  const emoji = document.getElementById('hEmoji')?.value || 'âœ…';
  const cat = document.getElementById('hCat')?.value;
  if(!name) { showToast('Preencha o nome do hÃ¡bito!', 'âš ï¸'); return; }
  data.habits.push({ id: Date.now(), name, emoji, cat, streak: 0, checkedDates: [] });
  saveData();
  closeModalDirect();
  showToast('HÃ¡bito criado!', 'ðŸŒ±');
}

function toggleHabit(id) {
  const habit = data.habits.find(h => h.id === id);
  if(!habit) return;
  const today = new Date().toISOString().split('T')[0];
  if(habit.checkedDates.includes(today)) {
    habit.checkedDates = habit.checkedDates.filter(d => d !== today);
    habit.streak = Math.max(0, habit.streak - 1);
  } else {
    habit.checkedDates.push(today);
    habit.streak += 1;
  }
  saveData();
}

function deleteHabit(id) {
  if(!confirm('Remover este hÃ¡bito?')) return;
  data.habits = data.habits.filter(h => h.id !== id);
  saveData();
}

function renderHabits(containerId = 'habitsContainer', isPreview = false) {
  const el = document.getElementById(containerId);
  if(!el) return;
  if(!data.habits.length) {
    el.innerHTML = `<div class="empty-state"><div class="empty-state-icon">ðŸŒ±</div><h3>Sem hÃ¡bitos</h3><p>Adicione hÃ¡bitos para rastrear seu crescimento diÃ¡rio</p></div>`;
    return;
  }
  const today = new Date().toISOString().split('T')[0];
  const items = isPreview ? data.habits.slice(0,4) : data.habits;
  el.innerHTML = items.map(h => {
    const checked = h.checkedDates?.includes(today);
    const last7 = getLast7Days().map(d => h.checkedDates?.includes(d));
    return `
    <div class="habit-item">
      <div class="habit-icon">${h.emoji}</div>
      <div class="habit-info">
        <div class="habit-name">${h.name}</div>
        <div class="habit-streak">ðŸ”¥ ${h.streak} dias seguidos</div>
      </div>
      <div class="habit-dots">${last7.map(d => `<div class="habit-dot ${d?'done':''}"></div>`).join('')}</div>
      <div class="habit-check ${checked?'checked':''}" onclick="toggleHabit(${h.id})"><i class="fas fa-check"></i></div>
      ${!isPreview ? `<div onclick="deleteHabit(${h.id})" style="margin-left:6px;color:var(--text3);cursor:pointer;font-size:12px;"><i class="fas fa-trash"></i></div>` : ''}
    </div>`;
  }).join('');
}

function getLast7Days() {
  const days = [];
  for(let i=6;i>=0;i--) {
    const d = new Date();
    d.setDate(d.getDate()-i);
    days.push(d.toISOString().split('T')[0]);
  }
  return days;
}

// ============================================================
// SKILLS
// ============================================================
function saveSkill() {
  const name = document.getElementById('skName')?.value;
  const emoji = document.getElementById('skEmoji')?.value || 'âš¡';
  const level = parseInt(document.getElementById('skLevelNum')?.value || document.getElementById('skLevel')?.value) || 30;
  if(!name) { showToast('Preencha o nome!', 'âš ï¸'); return; }
  data.skills.push({ id: Date.now(), name, emoji, level });
  saveData();
  closeModalDirect();
  showToast('Habilidade adicionada!', 'âš¡');
}

function deleteSkill(id) {
  data.skills = data.skills.filter(s => s.id !== id);
  saveData();
}

function renderSkills() {
  const el = document.getElementById('skillsContainer');
  if(!el) return;
  if(!data.skills.length) {
    el.innerHTML = `<div class="empty-state"><div class="empty-state-icon">âš¡</div><h3>Sem habilidades</h3><p>Adicione e acompanhe seu nÃ­vel em cada habilidade</p></div>`;
    return;
  }
  const levelColor = l => l >= 80 ? 'var(--accent3)' : l >= 50 ? 'var(--accent)' : 'var(--accent2)';
  el.innerHTML = data.skills.map(s => `
    <div class="skill-item">
      <div class="skill-header">
        <span>${s.emoji} ${s.name}</span>
        <span class="skill-level">${s.level}/100</span>
        <span onclick="deleteSkill(${s.id})" style="cursor:pointer;color:var(--text3);margin-left:8px;"><i class="fas fa-trash" style="font-size:11px;"></i></span>
      </div>
      <div class="progress-bar-wrap"><div class="progress-bar" style="width:${s.level}%;background:${levelColor(s.level)}"></div></div>
    </div>`).join('');
}

// ============================================================
// DIARY
// ============================================================
function saveDiary() {
  const text = document.getElementById('diaryText')?.value;
  if(!text?.trim()) { showToast('Escreva algo primeiro!', 'âš ï¸'); return; }
  data.diary.unshift({ id: Date.now(), text, date: new Date().toLocaleDateString('pt-BR', {weekday:'long',day:'numeric',month:'long',year:'numeric'}) });
  saveData();
  closeModalDirect();
  showToast('Registro salvo!', 'ðŸ“–');
}

function renderDiary() {
  const el = document.getElementById('diaryContainer');
  if(!el) return;
  if(!data.diary.length) {
    el.innerHTML = `<div class="empty-state"><div class="empty-state-icon">ðŸ“–</div><h3>DiÃ¡rio vazio</h3><p>Registre o que vocÃª aprendeu hoje</p></div>`;
    return;
  }
  el.innerHTML = data.diary.slice(0,5).map(e => `
    <div class="diary-entry">
      <div class="diary-date">${e.date}</div>
      <div class="diary-text">${e.text}</div>
    </div>`).join('');
}

// ============================================================
// CONFIG
// ============================================================
function saveProfileModal() {
  data.config.name = document.getElementById('mName')?.value || data.config.name;
  data.config.phrase = document.getElementById('mPhrase')?.value || data.config.phrase;
  saveData();
  closeModalDirect();
  showToast('Perfil atualizado!', 'âœ…');
}

function updateProfile() {
  const n = document.getElementById('configName')?.value;
  const p = document.getElementById('configPhrase')?.value;
  if(n) document.getElementById('profileName').textContent = n;
  if(p) document.getElementById('profilePhrase').textContent = p;
  const av = document.getElementById('avatarDisplay');
  if(av && n) av.textContent = n[0].toUpperCase();
}

function saveConfig() {
  data.config.name = document.getElementById('configName')?.value || data.config.name;
  data.config.phrase = document.getElementById('configPhrase')?.value || data.config.phrase;
  data.config.metaMensal = parseFloat(document.getElementById('configMeta')?.value) || 0;
  saveData();
  showToast('ConfiguraÃ§Ãµes salvas!', 'âœ…');
}

function exportData() {
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'mycore_backup.json';
  a.click();
  showToast('Dados exportados!', 'ðŸ“');
}

function clearData() {
  const user = getCurrentUser();
  if(user) localStorage.removeItem(getUserDataKey(user));
  else localStorage.removeItem('mycore_data');
  location.reload();
}

// ============================================================
// REPORTS â€” Real Export System
// ============================================================
let currentReportType = '';
let selectedExportFormats = [];

function openExportModal(reportType) {
  currentReportType = reportType;
  selectedExportFormats = [];

  const titles = {
    financeiro: 'ðŸ“Š RelatÃ³rio Financeiro',
    metas: 'ðŸŽ¯ RelatÃ³rio de Metas',
    desenvolvimento: 'ðŸŒ± RelatÃ³rio de Desenvolvimento',
    completo: 'âš¡ RelatÃ³rio Completo'
  };

  const overlay = document.getElementById('modal-overlay');
  const content = document.getElementById('modal-content');
  content.innerHTML = `
    <button class="modal-close" onclick="closeModalDirect()"><i class="fas fa-times"></i></button>
    <div class="modal-title">${titles[reportType]}</div>
    <p style="color:var(--text2);font-size:13px;margin-bottom:4px;">Escolha o(s) formato(s) de exportaÃ§Ã£o:</p>
    <div class="export-options">
      <div class="export-option" onclick="toggleExportFormat('pdf', this)" id="fmt-pdf">
        <div class="export-option-icon">ðŸ“„</div>
        <div class="export-option-label">PDF</div>
        <div class="export-option-desc">Documento formatado</div>
      </div>
      <div class="export-option" onclick="toggleExportFormat('excel', this)" id="fmt-excel">
        <div class="export-option-icon">ðŸ“Š</div>
        <div class="export-option-label">Excel</div>
        <div class="export-option-desc">Planilha de dados</div>
      </div>
      <div class="export-option" onclick="toggleExportFormat('image', this)" id="fmt-image">
        <div class="export-option-icon">ðŸ–¼ï¸</div>
        <div class="export-option-label">Imagem</div>
        <div class="export-option-desc">PNG para compartilhar</div>
      </div>
    </div>
    <div id="exportPreview" style="background:var(--surface);border-radius:var(--radius-sm);padding:16px;margin-bottom:20px;font-size:13px;color:var(--text2);min-height:60px;">
      Selecione um formato para ver o preview do relatÃ³rio.
    </div>
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="closeModalDirect()">Cancelar</button>
      <button class="btn btn-primary" onclick="doExportReport()" id="exportBtn" disabled style="opacity:0.5;">
        <i class="fas fa-download"></i> Exportar
      </button>
    </div>
  `;
  overlay.classList.add('open');
}

function toggleExportFormat(fmt, el) {
  el.classList.toggle('selected');
  if(selectedExportFormats.includes(fmt)) {
    selectedExportFormats = selectedExportFormats.filter(f => f !== fmt);
  } else {
    selectedExportFormats.push(fmt);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.disabled = selectedExportFormats.length === 0;
    btn.style.opacity = selectedExportFormats.length === 0 ? '0.5' : '1';
  }
  updateExportPreview();
}

function updateExportPreview() {
  const preview = document.getElementById('exportPreview');
  if(!preview) return;
  if(!selectedExportFormats.length) {
    preview.innerHTML = 'Selecione um formato para ver o preview do relatÃ³rio.';
    return;
  }
  const reportData = buildReportData(currentReportType);
  preview.innerHTML = `<strong style="color:var(--text)">${reportData.title}</strong><br><br>${reportData.preview}`;
}

function buildReportData(type) {
  const now = new Date().toLocaleDateString('pt-BR', {day:'numeric',month:'long',year:'numeric'});
  const rec = data.transactions.filter(t=>t.type==='receita').reduce((s,t)=>s+t.val,0);
  const dep = data.transactions.filter(t=>t.type==='despesa').reduce((s,t)=>s+t.val,0);
  const inv = data.transactions.filter(t=>t.type==='investimento').reduce((s,t)=>s+t.val,0);
  const saldo = rec - dep;
  const avgGoal = data.goals.length ? Math.round(data.goals.reduce((s,g)=>s+g.progress,0)/data.goals.length) : 0;

  const reports = {
    financeiro: {
      title: `ðŸ“Š RelatÃ³rio Financeiro â€” ${now}`,
      preview: `<span style="color:var(--accent3)">Receitas: ${fmtCurrency(rec)}</span> &nbsp;|&nbsp; <span style="color:var(--accent4)">Despesas: ${fmtCurrency(dep)}</span> &nbsp;|&nbsp; <span style="color:var(--accent)">Investimentos: ${fmtCurrency(inv)}</span><br>Saldo: <strong style="color:${saldo>=0?'var(--accent3)':'var(--accent4)'}">${fmtCurrency(saldo)}</strong> &nbsp;|&nbsp; ${data.transactions.length} transaÃ§Ãµes registradas`,
      content: () => `RELATÃ“RIO FINANCEIRO â€” MyCore\nGerado em: ${now}\n\nRECEITAS: ${fmtCurrency(rec)}\nDESPESAS: ${fmtCurrency(dep)}\nINVESTIMENTOS: ${fmtCurrency(inv)}\nSALDO: ${fmtCurrency(saldo)}\n\nTRANSAÃ‡Ã•ES (${data.transactions.length}):\n${data.transactions.map(t=>`  ${t.date} | ${t.type.toUpperCase()} | ${t.desc} | ${fmtCurrency(t.val)}`).join('\n')}`
    },
    metas: {
      title: `ðŸŽ¯ RelatÃ³rio de Metas â€” ${now}`,
      preview: `${data.goals.length} metas ativas &nbsp;|&nbsp; Progresso mÃ©dio: <strong style="color:var(--accent)">${avgGoal}%</strong><br>${data.goals.filter(g=>g.progress>=100).length} metas concluÃ­das`,
      content: () => `RELATÃ“RIO DE METAS â€” MyCore\nGerado em: ${now}\n\nTOTAL DE METAS: ${data.goals.length}\nPROGRESSO MÃ‰DIO: ${avgGoal}%\nCONCLUÃDAS: ${data.goals.filter(g=>g.progress>=100).length}\n\nDETALHE:\n${data.goals.map(g=>`  ${g.emoji} ${g.name} â€” ${g.progress}% | Prazo: ${g.deadline||'Sem prazo'}`).join('\n')}`
    },
    desenvolvimento: {
      title: `ðŸŒ± RelatÃ³rio de Desenvolvimento â€” ${now}`,
      preview: `${data.habits.length} hÃ¡bitos ativos &nbsp;|&nbsp; ${data.skills.length} habilidades &nbsp;|&nbsp; ${data.diary.length} registros no diÃ¡rio`,
      content: () => `RELATÃ“RIO DE DESENVOLVIMENTO â€” MyCore\nGerado em: ${now}\n\nHÃBITOS (${data.habits.length}):\n${data.habits.map(h=>`  ${h.emoji} ${h.name} â€” streak: ${h.streak} dias`).join('\n')}\n\nHABILIDADES (${data.skills.length}):\n${data.skills.map(s=>`  ${s.emoji} ${s.name} â€” nÃ­vel: ${s.level}/100`).join('\n')}\n\nDIÃRIO (Ãºltimos 5):\n${data.diary.slice(0,5).map(e=>`  [${e.date}] ${e.text.substring(0,100)}...`).join('\n')}`
    },
    completo: {
      title: `âš¡ RelatÃ³rio Completo â€” ${now}`,
      preview: `Life Score: <strong style="color:var(--accent2)">${document.getElementById('lifeScoreTop')?.textContent||78}</strong> &nbsp;|&nbsp; Perfil de ${data.config.name}<br>FinanÃ§as + Metas + Desenvolvimento + Conquistas`,
      content: () => `RELATÃ“RIO COMPLETO â€” MyCore\nUsuÃ¡rio: ${data.config.name}\nGerado em: ${now}\n\n--- FINANÃ‡AS ---\nReceitas: ${fmtCurrency(rec)} | Despesas: ${fmtCurrency(dep)} | Saldo: ${fmtCurrency(saldo)}\n\n--- METAS ---\n${data.goals.map(g=>`${g.emoji} ${g.name}: ${g.progress}%`).join(' | ')}\n\n--- HÃBITOS ---\n${data.habits.map(h=>`${h.emoji} ${h.name}: ${h.streak}d streak`).join(' | ')}\n\n--- CONQUISTAS ---\n${(data.achievements||[]).length} conquistas desbloqueadas`
    }
  };
  return reports[type] || reports.completo;
}

function doExportReport() {
  if(!selectedExportFormats.length) return;
  const reportData = buildReportData(currentReportType);
  const content = reportData.content();
  const fname = currentReportType + '_mycore_' + new Date().toISOString().split('T')[0];

  selectedExportFormats.forEach(fmt => {
    if(fmt === 'pdf') exportAsPDF(content, fname, reportData.title);
    else if(fmt === 'excel') exportAsCSV(content, fname);
    else if(fmt === 'image') exportAsImage(reportData, fname);
  });

  closeModalDirect();
  showToast(`RelatÃ³rio exportado em ${selectedExportFormats.join(', ').toUpperCase()}!`, 'ðŸ“Š');
}

function exportAsPDF(textContent, fname, title) {
  // Create a printable HTML and use window.print / blob
  const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${title}</title><style>
    body{font-family:Arial,sans-serif;padding:40px;color:#333;max-width:800px;margin:0 auto}
    h1{color:#6C63FF;border-bottom:2px solid #6C63FF;padding-bottom:10px}
    pre{white-space:pre-wrap;line-height:1.6;font-size:14px;background:#f5f5f5;padding:20px;border-radius:8px}
    .footer{margin-top:40px;color:#888;font-size:12px;border-top:1px solid #eee;padding-top:10px}
  </style></head><body>
    <h1>${title}</h1>
    <pre>${textContent}</pre>
    <div class="footer">Gerado pelo MyCore â€” ${new Date().toLocaleString('pt-BR')}</div>
  </body></html>`;
  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const w = window.open(url, '_blank');
  if(w) setTimeout(() => w.print(), 800);
}

function exportAsCSV(textContent, fname) {
  // Convert to CSV-like format
  const lines = textContent.split('\n');
  const csv = lines.map(l => `"${l.replace(/"/g,'""')}"`).join('\n');
  const blob = new Blob(['\uFEFF' + csv], {type:'text/csv;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = fname + '.csv'; a.click();
}

function exportAsImage(reportData, fname) {
  const canvas = document.createElement('canvas');
  canvas.width = 800; canvas.height = 500;
  const ctx = canvas.getContext('2d');

  // Background
  ctx.fillStyle = '#0f0f1a';
  ctx.fillRect(0, 0, 800, 500);

  // Header gradient
  const grad = ctx.createLinearGradient(0, 0, 800, 0);
  grad.addColorStop(0, 'rgba(108,99,255,0.3)');
  grad.addColorStop(1, 'rgba(108,99,255,0)');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, 800, 80);

  // Logo
  ctx.fillStyle = '#6C63FF';
  ctx.roundRect(30, 20, 44, 44, 10);
  ctx.fill();
  ctx.fillStyle = 'white';
  ctx.font = 'bold 22px Arial';
  ctx.fillText('âš¡', 41, 50);

  // Title
  ctx.fillStyle = '#E8E8F0';
  ctx.font = 'bold 22px Arial';
  ctx.fillText('MyCore', 85, 40);
  ctx.fillStyle = '#9090B0';
  ctx.font = '13px Arial';
  ctx.fillText(reportData.title.replace(/[ðŸ“ŠðŸŽ¯ðŸŒ±âš¡]/g,''), 85, 58);

  // Date
  ctx.fillStyle = '#5a5a7a';
  ctx.font = '12px monospace';
  ctx.fillText(new Date().toLocaleDateString('pt-BR'), 680, 40);

  // Content area
  ctx.fillStyle = '#1a1a2e';
  ctx.roundRect(20, 100, 760, 360, 12);
  ctx.fill();

  // Stats
  const lines = reportData.preview.replace(/<[^>]+>/g,'').split('\n').filter(Boolean);
  ctx.fillStyle = '#E8E8F0';
  ctx.font = '15px Arial';
  let y = 140;
  lines.forEach(line => {
    ctx.fillText(line.trim(), 40, y);
    y += 26;
  });

  // Footer
  ctx.fillStyle = '#5a5a7a';
  ctx.font = '11px Arial';
  ctx.fillText('Gerado pelo MyCore â€” ' + new Date().toLocaleString('pt-BR'), 30, 480);

  const url = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = url; a.download = fname + '.png'; a.click();
}

// ============================================================
// ACHIEVEMENTS
// ============================================================
const achievements = [
  { id:'first_tx', name:'Primeiro Passo', desc:'Registrou sua 1Âª transaÃ§Ã£o', icon:'ðŸš€', badge:'silver', check: () => data.transactions.length >= 1 },
  { id:'10_tx', name:'Registrador', desc:'10 transaÃ§Ãµes registradas', icon:'ðŸ“Š', badge:'silver', check: () => data.transactions.length >= 10 },
  { id:'50_tx', name:'Mestre Financeiro', desc:'50 transaÃ§Ãµes registradas', icon:'ðŸ’Ž', badge:'gold', check: () => data.transactions.length >= 50 },
  { id:'first_meta', name:'Sonhador', desc:'Criou sua 1Âª meta', icon:'ðŸŽ¯', badge:'silver', check: () => data.goals.length >= 1 },
  { id:'meta_100', name:'Conquista Ã‰pica', desc:'Uma meta atingiu 100%', icon:'ðŸ†', badge:'gold', check: () => data.goals.some(g => g.progress >= 100) },
  { id:'5_metas', name:'VisionÃ¡rio', desc:'Criou 5 metas', icon:'ðŸŒŸ', badge:'silver', check: () => data.goals.length >= 5 },
  { id:'first_habito', name:'Construtor', desc:'Criou seu 1Âº hÃ¡bito', icon:'ðŸŒ±', badge:'silver', check: () => data.habits.length >= 1 },
  { id:'streak_7', name:'Semana Perfeita', desc:'7 dias de streak em um hÃ¡bito', icon:'ðŸ”¥', badge:'gold', check: () => data.habits.some(h => h.streak >= 7) },
  { id:'streak_30', name:'ImplacÃ¡vel', desc:'30 dias de streak', icon:'âš¡', badge:'gold', check: () => data.habits.some(h => h.streak >= 30) },
  { id:'first_skill', name:'Aprendiz', desc:'Adicionou uma habilidade', icon:'ðŸ“š', badge:'silver', check: () => data.skills.length >= 1 },
  { id:'first_diary', name:'Reflexivo', desc:'Escreveu no diÃ¡rio', icon:'âœï¸', badge:'silver', check: () => data.diary.length >= 1 },
  { id:'all_habits_today', name:'Dia Perfeito', desc:'Completou todos os hÃ¡bitos do dia', icon:'ðŸŒž', badge:'gold', check: () => {
    if(!data.habits.length) return false;
    const today = new Date().toISOString().split('T')[0];
    return data.habits.every(h => h.checkedDates?.includes(today));
  }},
];

function checkAchievements() {
  let unlocked = false;
  achievements.forEach(a => {
    if(a.check() && !data.achievements?.includes(a.id)) {
      if(!data.achievements) data.achievements = [];
      data.achievements.push(a.id);
      unlocked = true;
      setTimeout(() => showToast(`Conquista desbloqueada: ${a.name}!`, a.icon), 500);
    }
  });
  if(unlocked) saveData();
}

function renderAchievements() {
  const grid = document.getElementById('achievementsGrid');
  if(!grid) return;
  const unlocked = data.achievements || [];
  grid.innerHTML = achievements.map(a => {
    const isUnlocked = unlocked.includes(a.id);
    return `
    <div class="achievement-card ${isUnlocked?'unlocked':'locked'}">
      <div class="achievement-icon">${a.icon}</div>
      <div class="achievement-name">${a.name}</div>
      <div class="achievement-desc">${a.desc}</div>
      <div class="achievement-badge ${isUnlocked?a.badge:'locked-badge'}">${isUnlocked?a.badge.toUpperCase():'BLOQUEADO'}</div>
    </div>`;
  }).join('');
}

// ============================================================
// CHARTS
// ============================================================
Chart.defaults.color = 'rgba(144,144,176,0.7)';
Chart.defaults.font.family = 'DM Sans';

let dashChartInst, finChartInst, catChartInst, radarChartInst, scoreChartInst, cashflowChartInst;

function destroyChart(inst) { try { inst?.destroy(); } catch(e) {} }

function initDashChart() {
  destroyChart(dashChartInst);
  const ctx = document.getElementById('dashChart');
  if(!ctx) return;
  const months = ['Jan','Fev','Mar','Abr','Mai','Jun'];
  const rec = [4200,3800,5100,4700,6200,data.transactions.filter(t=>t.type==='receita').reduce((s,t)=>s+t.val,0)||0];
  const dep = [2100,2800,2400,3100,2900,data.transactions.filter(t=>t.type==='despesa').reduce((s,t)=>s+t.val,0)||0];
  dashChartInst = new Chart(ctx, {
    type:'line',
    data:{
      labels: months,
      datasets:[
        { label:'Receitas', data:rec, borderColor:'#00D9A5', backgroundColor:'rgba(0,217,165,0.08)', tension:0.4, fill:true, pointBackgroundColor:'#00D9A5', pointRadius:4 },
        { label:'Despesas', data:dep, borderColor:'#FF6B6B', backgroundColor:'rgba(255,107,107,0.08)', tension:0.4, fill:true, pointBackgroundColor:'#FF6B6B', pointRadius:4 },
      ]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{legend:{display:true,position:'top',labels:{color:'#9090B0',boxWidth:10,font:{size:11}}}},
      scales:{
        x:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#5a5a7a'}},
        y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#5a5a7a',callback:v=>'R$'+v}}
      }
    }
  });
}

function initFinCharts() {
  destroyChart(finChartInst);
  destroyChart(catChartInst);

  const ctxFin = document.getElementById('finChart');
  if(ctxFin) {
    const months = ['Jan','Fev','Mar','Abr','Mai','Jun'];
    finChartInst = new Chart(ctxFin, {
      type:'bar',
      data:{
        labels:months,
        datasets:[
          {label:'Receitas',data:[4200,3800,5100,4700,6200,2100],backgroundColor:'rgba(0,217,165,0.7)',borderRadius:6},
          {label:'Despesas',data:[2100,2800,2400,3100,2900,1800],backgroundColor:'rgba(255,107,107,0.7)',borderRadius:6},
        ]
      },
      options:{
        responsive:true,maintainAspectRatio:false,
        plugins:{legend:{labels:{color:'#9090B0',boxWidth:10,font:{size:11}}}},
        scales:{
          x:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#5a5a7a'}},
          y:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#5a5a7a'}}
        }
      }
    });
  }

  const ctxCat = document.getElementById('catChart');
  if(ctxCat) {
    const cats = {};
    data.transactions.filter(t=>t.type==='despesa').forEach(t=>{ cats[t.cat] = (cats[t.cat]||0)+t.val; });
    const labels = Object.keys(cats).length ? Object.keys(cats) : ['Moradia','AlimentaÃ§Ã£o','Transporte','Lazer','Outros'];
    const vals = Object.keys(cats).length ? Object.values(cats) : [1200,800,400,300,200];
    catChartInst = new Chart(ctxCat, {
      type:'doughnut',
      data:{
        labels,
        datasets:[{data:vals, backgroundColor:['#6C63FF','#F0B429','#00D9A5','#FF6B6B','#9B8FFF','#FF9B9B'], borderWidth:0, hoverBorderWidth:2, hoverBorderColor:'#fff'}]
      },
      options:{
        responsive:true,maintainAspectRatio:false,
        plugins:{legend:{position:'right',labels:{color:'#9090B0',boxWidth:10,font:{size:11},padding:8}}}
      }
    });
  }
}

function initRadarChart() {
  destroyChart(radarChartInst);
  const ctx = document.getElementById('radarChart');
  if(!ctx) return;
  const r = data.radarValues;
  radarChartInst = new Chart(ctx, {
    type:'radar',
    data:{
      labels:['FinanÃ§as','Carreira','SaÃºde','Relacion.','Conhec.'],
      datasets:[{
        data:[r.fin,r.car,r.sau,r.rel,r.con],
        borderColor:'#6C63FF',
        backgroundColor:'rgba(108,99,255,0.15)',
        pointBackgroundColor:'#6C63FF',
        pointRadius:4,
        borderWidth:2,
      }]
    },
    options:{
      responsive:false,
      plugins:{legend:{display:false}},
      scales:{r:{
        min:0,max:100,
        grid:{color:'rgba(255,255,255,0.06)'},
        angleLines:{color:'rgba(255,255,255,0.06)'},
        pointLabels:{color:'#9090B0',font:{size:11}},
        ticks:{display:false}
      }}
    }
  });
}

function initReportCharts() {
  destroyChart(scoreChartInst);
  destroyChart(cashflowChartInst);

  const ctxScore = document.getElementById('scoreChart');
  if(ctxScore) {
    scoreChartInst = new Chart(ctxScore, {
      type:'line',
      data:{
        labels:['Jan','Fev','Mar','Abr','Mai','Jun'],
        datasets:[{label:'Life Score',data:[65,68,70,74,76,78],borderColor:'#F0B429',backgroundColor:'rgba(240,180,41,0.1)',tension:0.4,fill:true,pointBackgroundColor:'#F0B429',pointRadius:5}]
      },
      options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#9090B0'}}},scales:{
        x:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#5a5a7a'}},
        y:{min:0,max:100,grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#5a5a7a'}}
      }}
    });
  }

  const ctxCf = document.getElementById('cashflowChart');
  if(ctxCf) {
    cashflowChartInst = new Chart(ctxCf, {
      type:'bar',
      data:{
        labels:['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],
        datasets:[{label:'Fluxo',data:[2100,1000,2700,1600,3300,300,1800,2200,900,1400,2600,3800],backgroundColor:(ctx)=>ctx.raw>=0?'rgba(0,217,165,0.7)':'rgba(255,107,107,0.7)',borderRadius:4}]
      },
      options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#9090B0'}}},scales:{
        x:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#5a5a7a'}},
        y:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#5a5a7a'}}
      }}
    });
  }
}

// ============================================================
// UTILS
// ============================================================
function fmtCurrency(val) {
  return new Intl.NumberFormat('pt-BR', {style:'currency',currency:'BRL'}).format(val || 0);
}

let toastTimer;
function showToast(msg, icon = 'âœ…') {
  const t = document.getElementById('toast');
  document.getElementById('toast-msg').textContent = msg;
  document.getElementById('toast-icon').textContent = icon;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
}

// ============================================================
// REFRESH ALL
// ============================================================
function refreshAll() {
  const rec = data.transactions.filter(t=>t.type==='receita').reduce((s,t)=>s+t.val,0);
  const dep = data.transactions.filter(t=>t.type==='despesa').reduce((s,t)=>s+t.val,0);
  const inv = data.transactions.filter(t=>t.type==='investimento').reduce((s,t)=>s+t.val,0);
  const saldo = rec - dep;

  const setEl = (id, val) => { const el=document.getElementById(id); if(el) el.textContent=val; };
  setEl('dash-saldo', fmtCurrency(saldo));
  setEl('dash-receita', fmtCurrency(rec));
  setEl('dash-despesa', fmtCurrency(dep));
  setEl('dash-metas', data.goals.length);

  setEl('fin-receita', fmtCurrency(rec));
  setEl('fin-despesa', fmtCurrency(dep));
  const saldoEl = document.getElementById('fin-saldo');
  if(saldoEl) { saldoEl.textContent = fmtCurrency(saldo); saldoEl.style.color = saldo >= 0 ? 'var(--accent3)' : 'var(--accent4)'; }

  if(data.goals.length) {
    const avg = Math.round(data.goals.reduce((s,g)=>s+g.progress,0)/data.goals.length);
    setEl('dash-metas-pct', avg + '% mÃ©dia de progresso');
  }

  renderTransactions(data.transactions, 'dashTransactions', 4);
  renderTransactions(data.transactions, 'allTransactions');
  renderHabits('habitsContainer');
  renderHabits('dashHabits', true);
  renderGoals();
  renderSkills();
  renderDiary();

  const nameEl = document.getElementById('configName');
  if(nameEl) nameEl.value = data.config.name;
  const phraseEl = document.getElementById('configPhrase');
  if(phraseEl) phraseEl.value = data.config.phrase;
  const nameDisplay = document.getElementById('profileName');
  if(nameDisplay) nameDisplay.textContent = data.config.name;
  const phraseDisplay = document.getElementById('profilePhrase');
  if(phraseDisplay) phraseDisplay.textContent = data.config.phrase;
  const memberEl = document.getElementById('memberSince');
  if(memberEl) memberEl.textContent = data.config.memberSince;
  const av = document.getElementById('avatarDisplay');
  if(av) av.textContent = data.config.name[0]?.toUpperCase() || 'V';

  const life = Math.round((rec > 0 ? Math.min(85, (saldo/rec)*100) : 50) * 0.4 + (data.goals.length ? data.goals.reduce((s,g)=>s+g.progress,0)/data.goals.length*0.3 : 30) + (data.habits.filter(h=>h.streak>=1).length * 5));
  const score = Math.min(99, Math.max(40, life || 78));
  setEl('scoreMainNum', score);
  setEl('lifeScoreTop', score);

  const badgeEl = document.getElementById('badge-metas');
  if(badgeEl) badgeEl.textContent = data.goals.filter(g=>g.progress<100).length;

  setTimeout(() => {
    initDashChart();
    initFinCharts();
    initRadarChart();
  }, 50);

  checkAchievements();

  // Update topbar logout button with username
  const user = getCurrentUser();
  const users = getUsers();
  if(user && users[user]) {
    const existingUser = document.getElementById('topbarUser');
    if(!existingUser) {
      const topbar = document.querySelector('.topbar');
      const userBtn = document.createElement('div');
      userBtn.id = 'topbarUser';
      userBtn.style.cssText = 'display:flex;align-items:center;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:100px;padding:6px 14px;font-size:13px;cursor:pointer;';
      userBtn.innerHTML = `<span style="color:var(--text2)"><i class="fas fa-user-circle" style="color:var(--accent)"></i> ${users[user].name.split(' ')[0]}</span><span onclick="logoutUser()" title="Sair" style="color:var(--text3);margin-left:4px;"><i class="fas fa-sign-out-alt"></i></span>`;
      topbar.insertBefore(userBtn, topbar.querySelector('.quick-add-btn'));
    }
  }
}

// ============================================================
// INIT
// ============================================================
// Add enter key support for login
document.addEventListener('keydown', function(e) {
  if(e.key === 'Enter') {
    const overlay = document.getElementById('loginOverlay');
    if(overlay && overlay.style.display !== 'none' && !overlay.classList.contains('hidden')) {
      const loginForm = document.getElementById('loginForm');
      if(loginForm && loginForm.classList.contains('active')) doLogin();
      else doRegister();
    }
  }
});

// Check auth on load
if(!checkAuth()) {
  // Show login - already shown by default
  // Add sample data for demo
  data.transactions = [];
  data.goals = [];
  data.habits = [];
}

// Filter transactions
document.getElementById('filterTipo')?.addEventListener('change', function() {
  const filtered = this.value ? data.transactions.filter(t=>t.type===this.value) : data.transactions;
  renderTransactions(filtered, 'allTransactions');
});
</script>
</body>
</html>
